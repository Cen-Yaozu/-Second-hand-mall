{"remainingRequest":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/-Second-hand-mall/src/components/page/exchange/my-requests.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/macos/Desktop/-Second-hand-mall/src/components/page/exchange/my-requests.vue","mtime":1741938848334},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/babel-loader/lib/index.js","mtime":1741743640250},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js","mtime":1741743643788}],"contextDependencies":[],"result":["\nimport api from '@/api/index';\n\nexport default {\n  name: 'my-requests',\n  data() {\n    return {\n      requests: [],\n      loading: false,\n      detailDialogVisible: false,\n      currentExchange: null\n    }\n  },\n  mounted() {\n    this.loadRequests();\n  },\n  methods: {\n    loadRequests() {\n      this.loading = true;\n      api.getMyExchangeRequests().then(res => {\n        if (res.status_code === 1 && res.data) {\n          this.requests = res.data;\n        } else {\n          this.$message.error(res.msg || '获取交换请求失败');\n        }\n      }).catch(err => {\n        console.error('获取交换请求失败', err);\n        this.$message.error('获取交换请求失败');\n      }).finally(() => {\n        this.loading = false;\n      });\n    },\n    getFirstImage(pictureList) {\n      if (!pictureList) return require('@/assets/img/default.png');\n      if (typeof pictureList === 'string') {\n        try {\n          const images = JSON.parse(pictureList);\n          return images[0] || require('@/assets/img/default.png');\n        } catch (e) {\n          return pictureList || require('@/assets/img/default.png');\n        }\n      }\n      if (Array.isArray(pictureList)) {\n        return pictureList[0] || require('@/assets/img/default.png');\n      }\n      return require('@/assets/img/default.png');\n    },\n    formatDate(dateStr) {\n      if (!dateStr) return '';\n      const date = new Date(dateStr);\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;\n    },\n    getStatusType(status) {\n      switch (status) {\n        case 0: return 'info';    // 待审核\n        case 1: return 'success'; // 已接受\n        case 2: return 'danger';  // 已拒绝\n        case 3: return '';        // 已完成\n        default: return 'info';\n      }\n    },\n    viewDetail(row) {\n      this.currentExchange = row;\n      this.detailDialogVisible = true;\n    },\n    completeExchange(row) {\n      this.$confirm('确认已完成物品交换吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.loading = true;\n        api.completeExchange(row.id).then(res => {\n          if (res.status_code === 1) {\n            this.$message.success('交换已完成');\n            this.loadRequests();\n          } else {\n            this.$message.error(res.msg || '操作失败');\n          }\n        }).catch(err => {\n          console.error('操作失败', err);\n          this.$message.error('操作失败');\n        }).finally(() => {\n          this.loading = false;\n        });\n      }).catch(() => {});\n    },\n    goBack() {\n      this.$router.push('/exchange');\n    }\n  }\n}\n",{"version":3,"sources":["my-requests.vue"],"names":[],"mappings":";AA6KA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"my-requests.vue","sourceRoot":"src/components/page/exchange","sourcesContent":["<template>\n  <div class=\"my-requests-container\">\n    <el-card class=\"box-card\">\n      <div slot=\"header\" class=\"clearfix\">\n        <span class=\"title\">我发起的交换请求</span>\n        <el-button style=\"float: right; padding: 3px 0\" type=\"text\" @click=\"goBack\">返回</el-button>\n      </div>\n      \n      <el-table\n        v-loading=\"loading\"\n        :data=\"requests\"\n        style=\"width: 100%\"\n        empty-text=\"暂无交换请求\">\n        <el-table-column\n          label=\"请求物品\"\n          width=\"250\">\n          <template slot-scope=\"scope\">\n            <div class=\"item-info\">\n              <img :src=\"getFirstImage(scope.row.requestItem.pictureList)\" class=\"item-img\">\n              <div>\n                <div class=\"item-name\">{{ scope.row.requestItem.idleName }}</div>\n                <div class=\"item-price\">¥{{ scope.row.requestItem.idlePrice }}</div>\n              </div>\n            </div>\n          </template>\n        </el-table-column>\n        \n        <el-table-column\n          label=\"提供物品\"\n          width=\"250\">\n          <template slot-scope=\"scope\">\n            <div class=\"item-info\">\n              <img :src=\"getFirstImage(scope.row.offerItem.pictureList)\" class=\"item-img\">\n              <div>\n                <div class=\"item-name\">{{ scope.row.offerItem.idleName }}</div>\n                <div class=\"item-price\">¥{{ scope.row.offerItem.idlePrice }}</div>\n              </div>\n            </div>\n          </template>\n        </el-table-column>\n        \n        <el-table-column\n          label=\"物品所有者\"\n          width=\"150\">\n          <template slot-scope=\"scope\">\n            <div class=\"user-info\">\n              <img :src=\"scope.row.itemOwner.userAvatar || require('@/assets/img/avatar.png')\" class=\"user-avatar\">\n              <span>{{ scope.row.itemOwner.nickname }}</span>\n            </div>\n          </template>\n        </el-table-column>\n        \n        <el-table-column\n          prop=\"statusDesc\"\n          label=\"状态\"\n          width=\"100\">\n          <template slot-scope=\"scope\">\n            <el-tag :type=\"getStatusType(scope.row.status)\">{{ scope.row.statusDesc }}</el-tag>\n          </template>\n        </el-table-column>\n        \n        <el-table-column\n          prop=\"createTime\"\n          label=\"创建时间\"\n          width=\"180\">\n          <template slot-scope=\"scope\">\n            {{ formatDate(scope.row.createTime) }}\n          </template>\n        </el-table-column>\n        \n        <el-table-column\n          label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-button\n              size=\"mini\"\n              @click=\"viewDetail(scope.row)\">查看详情</el-button>\n            <el-button\n              size=\"mini\"\n              type=\"success\"\n              v-if=\"scope.row.status === 1\"\n              @click=\"completeExchange(scope.row)\">完成交换</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-card>\n  </div>\n  \n  <!-- 交换详情弹窗 -->\n  <el-dialog\n    title=\"交换详情\"\n    :visible.sync=\"detailDialogVisible\"\n    width=\"70%\">\n    <div v-if=\"currentExchange\" class=\"exchange-detail\">\n      <div class=\"status-section\">\n        <el-tag :type=\"getStatusType(currentExchange.status)\" size=\"medium\">{{ currentExchange.statusDesc }}</el-tag>\n        <span class=\"create-time\">创建时间：{{ formatDate(currentExchange.createTime) }}</span>\n      </div>\n      \n      <el-divider content-position=\"left\">交换信息</el-divider>\n      \n      <div class=\"exchange-info\">\n        <div class=\"exchange-item\">\n          <h3>请求方信息</h3>\n          <div class=\"user-info\" v-if=\"currentExchange.requestUser\">\n            <img :src=\"currentExchange.requestUser.userAvatar || require('@/assets/img/avatar.png')\" class=\"user-avatar\">\n            <div class=\"user-detail\">\n              <div class=\"user-name\">{{ currentExchange.requestUser.nickname }}</div>\n              <div class=\"user-contact\" v-if=\"currentExchange.requestUser.userPhone\">联系方式：{{ currentExchange.requestUser.userPhone }}</div>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"exchange-item\">\n          <h3>物品所有者信息</h3>\n          <div class=\"user-info\" v-if=\"currentExchange.itemOwner\">\n            <img :src=\"currentExchange.itemOwner.userAvatar || require('@/assets/img/avatar.png')\" class=\"user-avatar\">\n            <div class=\"user-detail\">\n              <div class=\"user-name\">{{ currentExchange.itemOwner.nickname }}</div>\n              <div class=\"user-contact\" v-if=\"currentExchange.itemOwner.userPhone\">联系方式：{{ currentExchange.itemOwner.userPhone }}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <el-divider content-position=\"left\">交换物品</el-divider>\n      \n      <div class=\"items-container\">\n        <div class=\"item-card\">\n          <h3>请求交换的物品</h3>\n          <div class=\"item-detail\" v-if=\"currentExchange.requestItem\">\n            <img :src=\"getFirstImage(currentExchange.requestItem.pictureList)\" class=\"item-img\">\n            <div class=\"item-info\">\n              <div class=\"item-name\">{{ currentExchange.requestItem.idleName }}</div>\n              <div class=\"item-price\">¥{{ currentExchange.requestItem.idlePrice }}</div>\n              <div class=\"item-desc\">{{ currentExchange.requestItem.idleDetails }}</div>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"exchange-arrow\">\n          <i class=\"el-icon-right\"></i>\n        </div>\n        \n        <div class=\"item-card\">\n          <h3>提供交换的物品</h3>\n          <div class=\"item-detail\" v-if=\"currentExchange.offerItem\">\n            <img :src=\"getFirstImage(currentExchange.offerItem.pictureList)\" class=\"item-img\">\n            <div class=\"item-info\">\n              <div class=\"item-name\">{{ currentExchange.offerItem.idleName }}</div>\n              <div class=\"item-price\">¥{{ currentExchange.offerItem.idlePrice }}</div>\n              <div class=\"item-desc\">{{ currentExchange.offerItem.idleDetails }}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <el-divider content-position=\"left\">交换理由</el-divider>\n      \n      <div class=\"reason-container\">\n        <p>{{ currentExchange.exchangeReason }}</p>\n      </div>\n      \n      <div class=\"action-container\" v-if=\"currentExchange.status === 1\">\n        <el-divider content-position=\"left\">操作</el-divider>\n        <div class=\"action-buttons\">\n          <el-button type=\"warning\" @click=\"completeExchange(currentExchange)\">完成交换</el-button>\n        </div>\n      </div>\n    </div>\n  </el-dialog>\n</template>\n\n<script>\nimport api from '@/api/index';\n\nexport default {\n  name: 'my-requests',\n  data() {\n    return {\n      requests: [],\n      loading: false,\n      detailDialogVisible: false,\n      currentExchange: null\n    }\n  },\n  mounted() {\n    this.loadRequests();\n  },\n  methods: {\n    loadRequests() {\n      this.loading = true;\n      api.getMyExchangeRequests().then(res => {\n        if (res.status_code === 1 && res.data) {\n          this.requests = res.data;\n        } else {\n          this.$message.error(res.msg || '获取交换请求失败');\n        }\n      }).catch(err => {\n        console.error('获取交换请求失败', err);\n        this.$message.error('获取交换请求失败');\n      }).finally(() => {\n        this.loading = false;\n      });\n    },\n    getFirstImage(pictureList) {\n      if (!pictureList) return require('@/assets/img/default.png');\n      if (typeof pictureList === 'string') {\n        try {\n          const images = JSON.parse(pictureList);\n          return images[0] || require('@/assets/img/default.png');\n        } catch (e) {\n          return pictureList || require('@/assets/img/default.png');\n        }\n      }\n      if (Array.isArray(pictureList)) {\n        return pictureList[0] || require('@/assets/img/default.png');\n      }\n      return require('@/assets/img/default.png');\n    },\n    formatDate(dateStr) {\n      if (!dateStr) return '';\n      const date = new Date(dateStr);\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;\n    },\n    getStatusType(status) {\n      switch (status) {\n        case 0: return 'info';    // 待审核\n        case 1: return 'success'; // 已接受\n        case 2: return 'danger';  // 已拒绝\n        case 3: return '';        // 已完成\n        default: return 'info';\n      }\n    },\n    viewDetail(row) {\n      this.currentExchange = row;\n      this.detailDialogVisible = true;\n    },\n    completeExchange(row) {\n      this.$confirm('确认已完成物品交换吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.loading = true;\n        api.completeExchange(row.id).then(res => {\n          if (res.status_code === 1) {\n            this.$message.success('交换已完成');\n            this.loadRequests();\n          } else {\n            this.$message.error(res.msg || '操作失败');\n          }\n        }).catch(err => {\n          console.error('操作失败', err);\n          this.$message.error('操作失败');\n        }).finally(() => {\n          this.loading = false;\n        });\n      }).catch(() => {});\n    },\n    goBack() {\n      this.$router.push('/exchange');\n    }\n  }\n}\n</script>\n\n<style scoped>\n.my-requests-container {\n  padding: 20px;\n}\n.title {\n  font-size: 22px;\n  font-weight: bold;\n  color: #409EFF;\n}\n.item-info {\n  display: flex;\n  align-items: center;\n}\n.item-img {\n  width: 50px;\n  height: 50px;\n  object-fit: cover;\n  margin-right: 10px;\n  border-radius: 4px;\n}\n.item-name {\n  font-size: 14px;\n  color: #303133;\n  margin-bottom: 5px;\n}\n.item-price {\n  font-size: 12px;\n  color: #F56C6C;\n}\n.user-info {\n  display: flex;\n  align-items: center;\n}\n.user-avatar {\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n  margin-right: 10px;\n}\n\n/* 交换详情弹窗样式 */\n.exchange-detail {\n  padding: 10px;\n}\n.status-section {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n.create-time {\n  color: #909399;\n  font-size: 14px;\n}\n.exchange-info {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 20px;\n}\n.exchange-item {\n  flex: 1;\n  padding: 10px;\n  border: 1px solid #EBEEF5;\n  border-radius: 4px;\n  margin: 0 10px;\n}\n.exchange-item:first-child {\n  margin-left: 0;\n}\n.exchange-item:last-child {\n  margin-right: 0;\n}\n.user-info {\n  display: flex;\n  align-items: center;\n  margin-top: 10px;\n}\n.user-avatar {\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  margin-right: 15px;\n}\n.user-detail {\n  flex: 1;\n}\n.user-name {\n  font-size: 16px;\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n.user-contact {\n  font-size: 14px;\n  color: #606266;\n}\n.items-container {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n.item-card {\n  flex: 1;\n  padding: 15px;\n  border: 1px solid #EBEEF5;\n  border-radius: 4px;\n}\n.exchange-arrow {\n  font-size: 30px;\n  color: #409EFF;\n  margin: 0 20px;\n}\n.item-detail {\n  display: flex;\n  margin-top: 15px;\n}\n.item-img {\n  width: 120px;\n  height: 120px;\n  object-fit: cover;\n  border-radius: 4px;\n  margin-right: 15px;\n}\n.item-info {\n  flex: 1;\n}\n.item-name {\n  font-size: 18px;\n  font-weight: bold;\n  margin-bottom: 10px;\n}\n.item-price {\n  font-size: 16px;\n  color: #F56C6C;\n  margin-bottom: 10px;\n}\n.item-desc {\n  font-size: 14px;\n  color: #606266;\n  line-height: 1.5;\n  max-height: 60px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n}\n.reason-container {\n  padding: 15px;\n  background-color: #F5F7FA;\n  border-radius: 4px;\n  margin-bottom: 20px;\n}\n.reason-container p {\n  margin: 0;\n  line-height: 1.6;\n  color: #606266;\n}\n.action-buttons {\n  display: flex;\n  justify-content: center;\n  margin-top: 20px;\n}\n</style> "]}]}