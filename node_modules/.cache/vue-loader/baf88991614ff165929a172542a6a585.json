{"remainingRequest":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/-Second-hand-mall/src/components/page/exchange.vue?vue&type=style&index=0&id=49ab8f7a&scoped=true&lang=css","dependencies":[{"path":"/Users/macos/Desktop/-Second-hand-mall/src/components/page/exchange.vue","mtime":1741934975563},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/css-loader/index.js","mtime":1741743640772},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1741743643789},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/postcss-loader/src/index.js","mtime":1741743642507},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js","mtime":1741743643788}],"contextDependencies":[],"result":["\n.container {\n  padding: 20px;\n  background-color: #fff;\n  border-radius: 5px;\n}\n.exchange-detail {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n.exchange-item {\n  border: 1px solid #ebeef5;\n  border-radius: 5px;\n  padding: 15px;\n}\n.item-info {\n  display: flex;\n  gap: 20px;\n}\n.item-image {\n  width: 120px;\n  height: 120px;\n  object-fit: cover;\n  border-radius: 5px;\n}\n.item-details {\n  flex: 1;\n}\n.exchange-reason, .exchange-status {\n  border: 1px solid #ebeef5;\n  border-radius: 5px;\n  padding: 15px;\n}\n",{"version":3,"sources":["exchange.vue"],"names":[],"mappings":";AAwTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"exchange.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\n  <div>\n    <div class=\"crumbs\">\n      <el-breadcrumb separator=\"/\">\n        <el-breadcrumb-item>\n          <i class=\"el-icon-lx-cascades\"></i> 物品交换\n        </el-breadcrumb-item>\n      </el-breadcrumb>\n    </div>\n    <div class=\"container\">\n      <el-tabs v-model=\"activeTab\" @tab-click=\"handleTabClick\">\n        <el-tab-pane label=\"我发起的交换\" name=\"myRequests\">\n          <el-table :data=\"myRequests\" style=\"width: 100%\">\n            <el-table-column prop=\"id\" label=\"ID\" width=\"80\"></el-table-column>\n            <el-table-column label=\"请求交换的物品\" width=\"200\">\n              <template slot-scope=\"scope\">\n                <div v-if=\"scope.row.requestItem\">\n                  <img :src=\"scope.row.requestItem.idleImg.split(',')[0]\" style=\"width: 50px; height: 50px;\">\n                  <div>{{ scope.row.requestItem.idleName }}</div>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column label=\"提供交换的物品\" width=\"200\">\n              <template slot-scope=\"scope\">\n                <div v-if=\"scope.row.offerItem\">\n                  <img :src=\"scope.row.offerItem.idleImg.split(',')[0]\" style=\"width: 50px; height: 50px;\">\n                  <div>{{ scope.row.offerItem.idleName }}</div>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"statusText\" label=\"状态\" width=\"100\"></el-table-column>\n            <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"180\"></el-table-column>\n            <el-table-column label=\"操作\" width=\"180\">\n              <template slot-scope=\"scope\">\n                <el-button\n                  size=\"mini\"\n                  @click=\"viewExchangeDetail(scope.row.id)\">查看详情</el-button>\n                <el-button\n                  v-if=\"scope.row.status === 1\"\n                  size=\"mini\"\n                  type=\"success\"\n                  @click=\"completeExchange(scope.row.id)\">完成交换</el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n        </el-tab-pane>\n        <el-tab-pane label=\"我收到的交换\" name=\"receivedRequests\">\n          <el-table :data=\"receivedRequests\" style=\"width: 100%\">\n            <el-table-column prop=\"id\" label=\"ID\" width=\"80\"></el-table-column>\n            <el-table-column label=\"请求交换的物品\" width=\"200\">\n              <template slot-scope=\"scope\">\n                <div v-if=\"scope.row.requestItem\">\n                  <img :src=\"scope.row.requestItem.idleImg.split(',')[0]\" style=\"width: 50px; height: 50px;\">\n                  <div>{{ scope.row.requestItem.idleName }}</div>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column label=\"提供交换的物品\" width=\"200\">\n              <template slot-scope=\"scope\">\n                <div v-if=\"scope.row.offerItem\">\n                  <img :src=\"scope.row.offerItem.idleImg.split(',')[0]\" style=\"width: 50px; height: 50px;\">\n                  <div>{{ scope.row.offerItem.idleName }}</div>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"statusText\" label=\"状态\" width=\"100\"></el-table-column>\n            <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"180\"></el-table-column>\n            <el-table-column label=\"操作\" width=\"220\">\n              <template slot-scope=\"scope\">\n                <el-button\n                  size=\"mini\"\n                  @click=\"viewExchangeDetail(scope.row.id)\">查看详情</el-button>\n                <el-button\n                  v-if=\"scope.row.status === 0\"\n                  size=\"mini\"\n                  type=\"success\"\n                  @click=\"acceptExchange(scope.row.id)\">接受</el-button>\n                <el-button\n                  v-if=\"scope.row.status === 0\"\n                  size=\"mini\"\n                  type=\"danger\"\n                  @click=\"rejectExchange(scope.row.id)\">拒绝</el-button>\n                <el-button\n                  v-if=\"scope.row.status === 1\"\n                  size=\"mini\"\n                  type=\"success\"\n                  @click=\"completeExchange(scope.row.id)\">完成交换</el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n        </el-tab-pane>\n      </el-tabs>\n      \n      <!-- 交换详情对话框 -->\n      <el-dialog title=\"交换详情\" :visible.sync=\"detailDialogVisible\" width=\"50%\">\n        <div v-if=\"currentExchange\">\n          <div class=\"exchange-detail\">\n            <div class=\"exchange-item\">\n              <h3>请求交换的物品</h3>\n              <div v-if=\"currentExchange.requestItem\" class=\"item-info\">\n                <img :src=\"currentExchange.requestItem.idleImg.split(',')[0]\" class=\"item-image\">\n                <div class=\"item-details\">\n                  <p><strong>名称：</strong>{{ currentExchange.requestItem.idleName }}</p>\n                  <p><strong>价格：</strong>¥{{ currentExchange.requestItem.idlePrice }}</p>\n                  <p><strong>描述：</strong>{{ currentExchange.requestItem.idleDescribe }}</p>\n                  <p><strong>所有者：</strong>{{ currentExchange.itemOwner ? currentExchange.itemOwner.nickname : '' }}</p>\n                </div>\n              </div>\n            </div>\n            <div class=\"exchange-item\">\n              <h3>提供交换的物品</h3>\n              <div v-if=\"currentExchange.offerItem\" class=\"item-info\">\n                <img :src=\"currentExchange.offerItem.idleImg.split(',')[0]\" class=\"item-image\">\n                <div class=\"item-details\">\n                  <p><strong>名称：</strong>{{ currentExchange.offerItem.idleName }}</p>\n                  <p><strong>价格：</strong>¥{{ currentExchange.offerItem.idlePrice }}</p>\n                  <p><strong>描述：</strong>{{ currentExchange.offerItem.idleDescribe }}</p>\n                  <p><strong>所有者：</strong>{{ currentExchange.requestUser ? currentExchange.requestUser.nickname : '' }}</p>\n                </div>\n              </div>\n            </div>\n            <div class=\"exchange-reason\">\n              <h3>交换理由</h3>\n              <p>{{ currentExchange.exchangeReason }}</p>\n            </div>\n            <div class=\"exchange-status\">\n              <h3>交换状态</h3>\n              <p>{{ currentExchange.statusText }}</p>\n              <p><strong>创建时间：</strong>{{ currentExchange.createTime }}</p>\n              <p v-if=\"currentExchange.updateTime\"><strong>更新时间：</strong>{{ currentExchange.updateTime }}</p>\n            </div>\n          </div>\n        </div>\n      </el-dialog>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'Exchange',\n  data() {\n    return {\n      activeTab: 'myRequests',\n      myRequests: [],\n      receivedRequests: [],\n      detailDialogVisible: false,\n      currentExchange: null\n    };\n  },\n  created() {\n    this.fetchMyRequests();\n  },\n  methods: {\n    // 获取我发起的交换请求\n    fetchMyRequests() {\n      this.$api.getMyExchangeRequests().then(res => {\n        if (res.status_code === 1) {\n          this.myRequests = res.data;\n          // 格式化日期\n          this.myRequests.forEach(item => {\n            if (item.createTime) {\n              item.createTime = this.formatDate(new Date(item.createTime));\n            }\n            if (item.updateTime) {\n              item.updateTime = this.formatDate(new Date(item.updateTime));\n            }\n          });\n        } else {\n          this.$message.error(res.msg || '获取交换请求失败');\n        }\n      }).catch(err => {\n        console.error(err);\n        this.$message.error('获取交换请求失败');\n      });\n    },\n    // 获取我收到的交换请求\n    fetchReceivedRequests() {\n      this.$api.getReceivedExchangeRequests().then(res => {\n        if (res.status_code === 1) {\n          this.receivedRequests = res.data;\n          // 格式化日期\n          this.receivedRequests.forEach(item => {\n            if (item.createTime) {\n              item.createTime = this.formatDate(new Date(item.createTime));\n            }\n            if (item.updateTime) {\n              item.updateTime = this.formatDate(new Date(item.updateTime));\n            }\n          });\n        } else {\n          this.$message.error(res.msg || '获取交换请求失败');\n        }\n      }).catch(err => {\n        console.error(err);\n        this.$message.error('获取交换请求失败');\n      });\n    },\n    // 处理标签页切换\n    handleTabClick(tab) {\n      if (tab.name === 'myRequests') {\n        this.fetchMyRequests();\n      } else if (tab.name === 'receivedRequests') {\n        this.fetchReceivedRequests();\n      }\n    },\n    // 查看交换详情\n    viewExchangeDetail(id) {\n      this.$api.getExchangeRequestDetail(id).then(res => {\n        if (res.status_code === 1) {\n          this.currentExchange = res.data;\n          // 格式化日期\n          if (this.currentExchange.createTime) {\n            this.currentExchange.createTime = this.formatDate(new Date(this.currentExchange.createTime));\n          }\n          if (this.currentExchange.updateTime) {\n            this.currentExchange.updateTime = this.formatDate(new Date(this.currentExchange.updateTime));\n          }\n          this.detailDialogVisible = true;\n        } else {\n          this.$message.error(res.msg || '获取交换详情失败');\n        }\n      }).catch(err => {\n        console.error(err);\n        this.$message.error('获取交换详情失败');\n      });\n    },\n    // 接受交换请求\n    acceptExchange(id) {\n      this.$confirm('确定接受此交换请求?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.$api.acceptExchangeRequest(id).then(res => {\n          if (res.status_code === 1) {\n            this.$message.success(res.msg || '已接受交换请求');\n            this.fetchReceivedRequests();\n          } else {\n            this.$message.error(res.msg || '接受交换请求失败');\n          }\n        }).catch(err => {\n          console.error(err);\n          this.$message.error('接受交换请求失败');\n        });\n      }).catch(() => {\n        this.$message.info('已取消操作');\n      });\n    },\n    // 拒绝交换请求\n    rejectExchange(id) {\n      this.$confirm('确定拒绝此交换请求?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.$api.rejectExchangeRequest(id).then(res => {\n          if (res.status_code === 1) {\n            this.$message.success(res.msg || '已拒绝交换请求');\n            this.fetchReceivedRequests();\n          } else {\n            this.$message.error(res.msg || '拒绝交换请求失败');\n          }\n        }).catch(err => {\n          console.error(err);\n          this.$message.error('拒绝交换请求失败');\n        });\n      }).catch(() => {\n        this.$message.info('已取消操作');\n      });\n    },\n    // 完成交换\n    completeExchange(id) {\n      this.$confirm('确认已完成物品交换?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.$api.completeExchangeRequest(id).then(res => {\n          if (res.status_code === 1) {\n            this.$message.success(res.msg || '交换已完成');\n            if (this.activeTab === 'myRequests') {\n              this.fetchMyRequests();\n            } else {\n              this.fetchReceivedRequests();\n            }\n          } else {\n            this.$message.error(res.msg || '完成交换失败');\n          }\n        }).catch(err => {\n          console.error(err);\n          this.$message.error('完成交换失败');\n        });\n      }).catch(() => {\n        this.$message.info('已取消操作');\n      });\n    },\n    // 格式化日期\n    formatDate(date) {\n      const year = date.getFullYear();\n      const month = (date.getMonth() + 1).toString().padStart(2, '0');\n      const day = date.getDate().toString().padStart(2, '0');\n      const hours = date.getHours().toString().padStart(2, '0');\n      const minutes = date.getMinutes().toString().padStart(2, '0');\n      const seconds = date.getSeconds().toString().padStart(2, '0');\n      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.container {\n  padding: 20px;\n  background-color: #fff;\n  border-radius: 5px;\n}\n.exchange-detail {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n.exchange-item {\n  border: 1px solid #ebeef5;\n  border-radius: 5px;\n  padding: 15px;\n}\n.item-info {\n  display: flex;\n  gap: 20px;\n}\n.item-image {\n  width: 120px;\n  height: 120px;\n  object-fit: cover;\n  border-radius: 5px;\n}\n.item-details {\n  flex: 1;\n}\n.exchange-reason, .exchange-status {\n  border: 1px solid #ebeef5;\n  border-radius: 5px;\n  padding: 15px;\n}\n</style> "]}]}