{"remainingRequest":"D:\\Desktop\\-Second-hand-mall\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Desktop\\-Second-hand-mall\\src\\components\\page\\order.vue?vue&type=style&index=0&id=8b2a0244&scoped=true&lang=css","dependencies":[{"path":"D:\\Desktop\\-Second-hand-mall\\src\\components\\page\\order.vue","mtime":1741159852059},{"path":"D:\\Desktop\\-Second-hand-mall\\node_modules\\css-loader\\index.js","mtime":1741229036453},{"path":"D:\\Desktop\\-Second-hand-mall\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1741229036550},{"path":"D:\\Desktop\\-Second-hand-mall\\node_modules\\postcss-loader\\src\\index.js","mtime":1741229036447},{"path":"D:\\Desktop\\-Second-hand-mall\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741229036518},{"path":"D:\\Desktop\\-Second-hand-mall\\node_modules\\vue-loader\\lib\\index.js","mtime":1741229036465}],"contextDependencies":[],"result":["\n.order-page-container {\n    min-height: 85vh;\n}\n\n.idle-info-container {\n    width: 100%;\n    display: flex;\n    border-bottom: 20px solid #f6f6f6;\n    padding: 20px;\n    cursor: pointer;\n}\n\n.idle-info-title {\n    font-size: 18px;\n    font-weight: 600;\n    max-width: 750px;\n    margin-left: 10px;\n}\n\n.idle-info-price {\n    font-size: 18px;\n    color: red;\n    margin-left: 10px;\n}\n\n.address-container {\n    min-height: 60px;\n    padding: 20px;\n    border-bottom: 20px solid #f6f6f6;\n\n}\n\n.address-title {\n    font-size: 18px;\n    font-weight: 600;\n    margin-bottom: 10px;\n}\n\n.address-detials {\n    font-size: 16px;\n    color: #444444;\n}\n\n.order-info-container {\n    padding: 20px;\n}\n\n.order-info-item {\n    margin: 10px 0;\n    font-size: 14px;\n    color: #444444;\n}\n\n.menu {\n    margin-left: 20px;\n}\n",{"version":3,"sources":["order.vue"],"names":[],"mappings":";AAkbA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"order.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\r\n    <div>\r\n        <app-head></app-head>\r\n        <app-body>\r\n            <div class=\"order-page-container\">\r\n                <div class=\"idle-info-container\" @click=\"toDetails(orderInfo.idleItem.id)\">\r\n                    <el-image\r\n                            style=\"width: 150px; height: 150px;\"\r\n                            :src=\"orderInfo.idleItem.imgUrl\"\r\n                            fit=\"cover\"></el-image>\r\n                    <div class=\"idle-info-title\">{{orderInfo.userId==userId?'买到的':'卖出的'}}：{{orderInfo.idleItem.idleName}}</div>\r\n                    <div class=\"idle-info-price\">￥{{orderInfo.orderPrice}}</div>\r\n\r\n                </div>\r\n                <div class=\"address-container\" @click.stop=\"selectAddressDialog\" :style=\"orderInfo.userId==userId&&orderInfo.orderStatus===0?'cursor: pointer;':''\">\r\n                    <div class=\"address-title\">收货地址: {{addressInfo.consigneeName}} {{addressInfo.consigneePhone}}</div>\r\n                    <div class=\"address-detials\">{{addressInfo.detailAddress}}</div>\r\n                    <el-button v-if=\"!addressInfo.detailAddress\" @click.stop=\"selectAddressDialog\" type=\"primary\" plain>选择收货地址</el-button>\r\n                </div>\r\n                <el-dialog\r\n                        title=\"选择地址\"\r\n                        :visible.sync=\"addressDialogVisible\"\r\n                        width=\"800px\">\r\n                    <el-dialog\r\n                        width=\"50%\"\r\n                        title=\"添 加 收 货 地 址\"\r\n                        :visible.sync=\"innerVisible\"\r\n                        append-to-body>\r\n                        <el-form :model=\"addressForm\" ref=\"addressForm\" label-width=\"100px\" @submit.prevent=\"handleSubmit\">\r\n                            <!-- 手机号 -->\r\n                            <el-form-item label=\"手机号\" prop=\"phone\">\r\n                                <el-input v-model=\"addressForm.consigneePhone\" placeholder=\"请输入手机号\"></el-input>\r\n                            </el-form-item>\r\n\r\n                            <!-- 姓名 -->\r\n                            <el-form-item label=\"姓名\" prop=\"name\">\r\n                                <el-input v-model=\"addressForm.consigneeName\" placeholder=\"请输入姓名\"></el-input>\r\n                            </el-form-item>\r\n\r\n                            <!-- 具体地址 -->\r\n                            <el-form-item label=\"具体地址\" prop=\"detail\">\r\n                                <el-input v-model=\"addressForm.detailAddress\" type=\"textarea\" placeholder=\"请输入详细地址\"></el-input>\r\n                            </el-form-item>\r\n\r\n<!--                            <div slot=\"footer\" class=\"dialog-footer\">-->\r\n                                <el-button @click=\"innerVisible = false\">取 消</el-button>\r\n                                <el-button type=\"primary\" @click=\"saveAddress\">保 存</el-button>\r\n<!--                            </div>-->\r\n                        </el-form>\r\n                    </el-dialog>\r\n\r\n                    <div slot=\"footer\" class=\"dialog-footer\">\r\n                        <el-button @click=\"addressDialogVisible = false\">取 消</el-button>\r\n                        <el-button type=\"primary\" @click=\"innerVisible = true\">添 加 收 货 地 址</el-button>\r\n                    </div>\r\n                    <el-table\r\n                            stripe\r\n                            empty-text=\"无地址信息，请先添加地址\"\r\n                            :data=\"addressData\"\r\n                            style=\"width: 100%\">\r\n                        <el-table-column\r\n                                prop=\"consigneeName\"\r\n                                label=\"收货人姓名\"\r\n                                width=\"120\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                prop=\"consigneePhone\"\r\n                                label=\"手机号\"\r\n                                width=\"140\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                prop=\"detailAddressText\"\r\n                                label=\"地址\">\r\n                        </el-table-column>\r\n                        <el-table-column label=\" \" width=\"120\">\r\n                            <template slot-scope=\"scope\">\r\n                                <el-button\r\n                                        size=\"mini\"\r\n                                        @click=\"selectAddress(scope.$index, scope.row)\">选择\r\n                                </el-button>\r\n\r\n                            </template>\r\n                        </el-table-column>\r\n                    </el-table>\r\n                </el-dialog>\r\n                <div class=\"order-info-container\">\r\n                    <div class=\"order-info-title\">订单信息（{{orderStatus[orderInfo.orderStatus]}}）：</div>\r\n                    <div class=\"order-info-item\">编号：{{orderInfo.orderNumber}}</div>\r\n                    <div class=\"order-info-item\">支付状态：{{orderInfo.paymentStatus===0?'未支付':'已支付'}}</div>\r\n                    <div class=\"order-info-item\">支付方式：{{orderInfo.paymentWay}}</div>\r\n                    <div class=\"order-info-item\">创建时间：{{orderInfo.createTime.substring(0, 10) + ' ' +\r\n                        orderInfo.createTime.substring(11, 19)}}\r\n                    </div>\r\n                    <div class=\"order-info-item\">支付时间：{{orderInfo.paymentTime?orderInfo.paymentTime.substring(0, 10) + ' ' +\r\n                        orderInfo.paymentTime.substring(11, 19):''}}\r\n                    </div>\r\n                </div>\r\n                <div class=\"menu\">\r\n                    <el-button v-if=\"userId==orderInfo.userId&&orderInfo.orderStatus===0\" type=\"danger\" plain @click=\"changeOrderStatus(4,orderInfo)\">取消订单</el-button>\r\n                    <el-button v-if=\"userId==orderInfo.userId&&orderInfo.orderStatus===0\" type=\"primary\" plain @click=\"changeOrderStatus(1,orderInfo)\">立即支付</el-button>\r\n                    <el-button v-if=\"userId==orderInfo.idleItem.userId&&orderInfo.orderStatus===1\" type=\"primary\" plain @click=\"changeOrderStatus(2,orderInfo)\">发货</el-button>\r\n                    <el-button v-if=\"userId==orderInfo.userId&&orderInfo.orderStatus===2\" type=\"primary\" plain @click=\"changeOrderStatus(3,orderInfo)\">确认收货</el-button>\r\n                </div>\r\n            </div>\r\n            <app-foot></app-foot>\r\n        </app-body>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import AppHead from '../common/AppHeader.vue';\r\n    import AppBody from '../common/AppPageBody.vue'\r\n    import AppFoot from '../common/AppFoot.vue'\r\n\r\n    export default {\r\n        name: \"order\",\r\n        components: {\r\n            AppHead,\r\n            AppBody,\r\n            AppFoot\r\n        },\r\n        data() {\r\n            return {\r\n                innerVisible: false,\r\n                addressDialogVisible:false,\r\n                addressData: [],\r\n                orderStatus: ['待付款', '待发货', '待收货', '已完成', '已取消'],\r\n                addressForm: {\r\n                    consigneeName: '',\r\n                    consigneePhone: '',\r\n                    provinceName: '',\r\n                    cityName: '',\r\n                    regionName: '',\r\n                    detailAddress: '',\r\n                    defaultFlag: false\r\n                },\r\n                selectedOptions: [],//存放默认值\r\n                orderInfo: {\r\n                    createTime: \"\",\r\n                    id: 0,\r\n                    idleId: 0,\r\n                    idleItem: {\r\n                        id: '',\r\n                        idleName: '',\r\n                        idleDetails: '',\r\n                        pictureList: [],\r\n                        idlePrice: 0,\r\n                        idlePlace: '',\r\n                        idleLabel: '',\r\n                        idleStatus: -1,\r\n                        userId: '',\r\n                    },\r\n                    orderNumber: \"\",\r\n                    orderPrice: 0,\r\n                    orderStatus: 0,\r\n                    paymentStatus: 0,\r\n                    paymentTime: \"\",\r\n                    paymentWay: \"\",\r\n                    userId: 0\r\n                },\r\n                addressInfo: {\r\n                    id:'',\r\n                    update:false,\r\n                    consigneeName: '',\r\n                    consigneePhone: '',\r\n                    detailAddress: ''\r\n                },\r\n                userId:''\r\n            };\r\n        },\r\n        created() {\r\n            this.userId=this.getCookie('shUserId');\r\n            console.log('userId',this.userId,this.getCookie('shUserId'));\r\n            let orderId = this.$route.query.id;\r\n            console.log(orderId);\r\n            debugger\r\n            this.$api.getOrder({\r\n                id: orderId\r\n            }).then(res => {\r\n                console.log(res);\r\n                if (res.status_code === 1) {\r\n                    if (res.data.idleItem) {\r\n                        let imgList = JSON.parse(res.data.idleItem.pictureList);\r\n                        if (imgList.length > 0) {\r\n                            res.data.idleItem.imgUrl = imgList[0];\r\n                        } else {\r\n                            res.data.idleItem.imgUrl = '';\r\n                        }\r\n                    } else {\r\n                        res.data.idleItem = {\r\n                            idleName: '',\r\n                            imgUrl: ''\r\n                        }\r\n                    }\r\n                    this.orderInfo = res.data;\r\n                    this.$api.getOrderAddress({\r\n                        orderId:this.orderInfo.id\r\n                    }).then(res=>{\r\n                        if(res.data){\r\n                            this.addressInfo= res.data;\r\n                            this.addressInfo.update=true;\r\n                        }else{\r\n                            this.getAddressData();\r\n                        }\r\n                    })\r\n                }\r\n            })\r\n        },\r\n        methods: {\r\n            saveAddress(){\r\n                this.$api.addAddress(this.addressForm).then(res => {\r\n                    if (res.status_code === 1) {\r\n                        this.$message({\r\n                            message: '新增成功！',\r\n                            type: 'success'\r\n                        });\r\n                        this.selectedOptions = [];\r\n                        this.addressInfo = {\r\n                            consigneeName: '',\r\n                            consigneePhone: '',\r\n                            provinceName: '',\r\n                            cityName: '',\r\n                            regionName: '',\r\n                            detailAddress: '',\r\n                            defaultFlag: false\r\n                        };\r\n                        this.innerVisible = false;\r\n                        this.getAddressData();\r\n                    } else {\r\n                        this.$message.error('系统异常，新增失败！')\r\n                    }\r\n                }).catch(e => {\r\n                    this.$message.error('网络异常！')\r\n                })\r\n            },\r\n\r\n            handleSubmit(){\r\n\r\n            },\r\n            getCookie(cname){\r\n                var name = cname + \"=\";\r\n                var ca = document.cookie.split(';');\r\n                for(var i=0; i<ca.length; i++)\r\n                {\r\n                    var c = ca[i].trim();\r\n                    if (c.indexOf(name)===0) return c.substring(name.length,c.length);\r\n                }\r\n                return \"0\";\r\n            },\r\n            toDetails(id) {\r\n                this.$router.replace({path: 'details', query: {id: id}});\r\n            },\r\n            selectAddressDialog(){\r\n                if(this.orderInfo.userId==this.userId&&this.orderInfo.orderStatus===0){\r\n                    this.addressDialogVisible=true;\r\n                    if(this.addressData.length===0){\r\n                        this.getAddressData();\r\n                    }\r\n                }\r\n            },\r\n            getAddressData(){\r\n                this.$api.getAddress().then(res => {\r\n                    if (res.status_code === 1) {\r\n                        let data = res.data;\r\n                        for (let i = 0; i < data.length; i++) {\r\n                            data[i].detailAddressText = data[i].provinceName + data[i].cityName + data[i].regionName + data[i].detailAddress;\r\n                        }\r\n                        console.log(data);\r\n                        this.addressData = data;\r\n                        if(!this.addressInfo.update){\r\n                            for(let i=0;i<data.length;i++){\r\n                                if(data[i].defaultFlag){\r\n                                    this.selectAddress(i,data[i]);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                })\r\n            },\r\n            selectAddress(i,item){\r\n                // this.addressDialogVisible=false;\r\n                console.log(item,this.addressInfo);\r\n                this.addressInfo.consigneeName=item.consigneeName;\r\n                this.addressInfo.consigneePhone=item.consigneePhone;\r\n                this.addressInfo.detailAddress=item.detailAddressText;\r\n                if(this.addressInfo.update){\r\n                    this.$api.updateOrderAddress({\r\n                        id:this.addressInfo.id,\r\n                        consigneeName:item.consigneeName,\r\n                        consigneePhone:item.consigneePhone,\r\n                        detailAddress:item.detailAddressText\r\n                    })\r\n                }else{\r\n                    this.$api.addOrderAddress({\r\n                        orderId:this.orderInfo.id,\r\n                        consigneeName:item.consigneeName,\r\n                        consigneePhone:item.consigneePhone,\r\n                        detailAddress:item.detailAddressText\r\n                    }).then(res=>{\r\n                        if(res.status_code===1){\r\n                            this.addressInfo.update=true;\r\n                            this.addressInfo.id=res.data.id;\r\n                        }else {\r\n                            this.$message.error(res.msg)\r\n                        }\r\n                    })\r\n                }\r\n\r\n            },\r\n            changeOrderStatus(orderStatus, orderInfo) {\r\n                if (orderStatus === 1) {\r\n                    console.log('zhifu');\r\n                    if(!this.addressInfo.detailAddress){\r\n                        this.$message.error('请选择地址！')\r\n                    }else{\r\n                        this.$confirm('模拟支付宝支付，是否确认支付', '支付订单', {\r\n                            confirmButtonText: '支付',\r\n                            cancelButtonText: '取消',\r\n                            type: 'warning'\r\n                        }).then(() => {\r\n                            var address = \"http://localhost:8080/alipay/pay?subject=\" + orderInfo.orderNumber+ \"&traceNo=\"+\r\n                                orderInfo.id + \"&totalAmount=\" + orderInfo.idleItem.idlePrice;\r\n\r\n                            // console.log(res.data[0]);\r\n                            // res.data.\r\n                            window.open(address)\r\n\r\n                        //     this.$api.updateOrder({\r\n                        //             id: orderInfo.id,\r\n                        //             orderStatus: orderStatus,\r\n                        //             paymentStatus: 1,\r\n                        //             paymentWay: '支付宝',\r\n                        //         }).then(res => {\r\n                        //             var address = \"http://localhost:8080/alipay/pay?name=\" + orderInfo.id + \"&no=\"+\r\n                        //               Math.random().toString(36).substr(2) + \"&price=\" + orderInfo.idleItem.idlePrice;\r\n                        //\r\n                        //             console.log(res.data[0]);\r\n                        //             // res.data.\r\n                        //             window.open(address)\r\n                        //\r\n                        //             if (res.status_code === 1) {\r\n                        //                 this.$message({\r\n                        //                     message: '支付成功！',\r\n                        //                     type: 'success'\r\n                        //                 });\r\n                        //                 this.orderInfo.orderStatus = orderStatus;\r\n                        //                 this.orderInfo.paymentStatus = 1;\r\n                        //                 this.orderInfo.paymentWay = '支付宝';\r\n                        //                 this.orderInfo.paymentTime = res.data.paymentTime;\r\n                        //             }\r\n                        //         })\r\n                        //\r\n                        // }).catch(() => {\r\n                        });\r\n                    }\r\n                } else {\r\n                    this.$api.updateOrder({\r\n                        id: orderInfo.id,\r\n                        orderStatus: orderStatus,\r\n                    }).then(res => {\r\n                        if (res.status_code === 1) {\r\n                            this.$message({\r\n                                message: '操作成功！',\r\n                                type: 'success'\r\n                            });\r\n                            this.orderInfo.orderStatus = orderStatus;\r\n                        }\r\n                    })\r\n                }\r\n            },\r\n        }\r\n\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .order-page-container {\r\n        min-height: 85vh;\r\n    }\r\n\r\n    .idle-info-container {\r\n        width: 100%;\r\n        display: flex;\r\n        border-bottom: 20px solid #f6f6f6;\r\n        padding: 20px;\r\n        cursor: pointer;\r\n    }\r\n\r\n    .idle-info-title {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        max-width: 750px;\r\n        margin-left: 10px;\r\n    }\r\n\r\n    .idle-info-price {\r\n        font-size: 18px;\r\n        color: red;\r\n        margin-left: 10px;\r\n    }\r\n\r\n    .address-container {\r\n        min-height: 60px;\r\n        padding: 20px;\r\n        border-bottom: 20px solid #f6f6f6;\r\n\r\n    }\r\n\r\n    .address-title {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        margin-bottom: 10px;\r\n    }\r\n\r\n    .address-detials {\r\n        font-size: 16px;\r\n        color: #444444;\r\n    }\r\n\r\n    .order-info-container {\r\n        padding: 20px;\r\n    }\r\n\r\n    .order-info-item {\r\n        margin: 10px 0;\r\n        font-size: 14px;\r\n        color: #444444;\r\n    }\r\n\r\n    .menu {\r\n        margin-left: 20px;\r\n    }\r\n</style>\r\n"]}]}