{"remainingRequest":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/-Second-hand-mall/src/components/page/order.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/macos/Desktop/-Second-hand-mall/src/components/page/order.vue","mtime":1741743644074},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/babel-loader/lib/index.js","mtime":1741743640250},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js","mtime":1741743643788}],"contextDependencies":[],"result":["\n    import AppHead from '../common/AppHeader.vue';\n    import AppBody from '../common/AppPageBody.vue'\n    import AppFoot from '../common/AppFoot.vue'\n\n    export default {\n        name: \"order\",\n        components: {\n            AppHead,\n            AppBody,\n            AppFoot\n        },\n        data() {\n            return {\n                innerVisible: false,\n                addressDialogVisible:false,\n                addressData: [],\n                orderStatus: ['待付款', '待发货', '待收货', '已完成', '已取消'],\n                addressForm: {\n                    consigneeName: '',\n                    consigneePhone: '',\n                    provinceName: '',\n                    cityName: '',\n                    regionName: '',\n                    detailAddress: '',\n                    defaultFlag: false\n                },\n                selectedOptions: [],//存放默认值\n                orderInfo: {\n                    createTime: \"\",\n                    id: 0,\n                    idleId: 0,\n                    idleItem: {\n                        id: '',\n                        idleName: '',\n                        idleDetails: '',\n                        pictureList: [],\n                        idlePrice: 0,\n                        idlePlace: '',\n                        idleLabel: '',\n                        idleStatus: -1,\n                        userId: '',\n                    },\n                    orderNumber: \"\",\n                    orderPrice: 0,\n                    orderStatus: 0,\n                    paymentStatus: 0,\n                    paymentTime: \"\",\n                    paymentWay: \"\",\n                    userId: 0\n                },\n                addressInfo: {\n                    id:'',\n                    update:false,\n                    consigneeName: '',\n                    consigneePhone: '',\n                    detailAddress: ''\n                },\n                userId:''\n            };\n        },\n        created() {\n            this.userId=this.getCookie('shUserId');\n            console.log('userId',this.userId,this.getCookie('shUserId'));\n            let orderId = this.$route.query.id;\n            console.log(orderId);\n            debugger\n            this.$api.getOrder({\n                id: orderId\n            }).then(res => {\n                console.log(res);\n                if (res.status_code === 1) {\n                    if (res.data.idleItem) {\n                        let imgList = JSON.parse(res.data.idleItem.pictureList);\n                        if (imgList.length > 0) {\n                            res.data.idleItem.imgUrl = imgList[0];\n                        } else {\n                            res.data.idleItem.imgUrl = '';\n                        }\n                    } else {\n                        res.data.idleItem = {\n                            idleName: '',\n                            imgUrl: ''\n                        }\n                    }\n                    this.orderInfo = res.data;\n                    this.$api.getOrderAddress({\n                        orderId:this.orderInfo.id\n                    }).then(res=>{\n                        if(res.data){\n                            this.addressInfo= res.data;\n                            this.addressInfo.update=true;\n                        }else{\n                            this.getAddressData();\n                        }\n                    })\n                }\n            })\n        },\n        methods: {\n            saveAddress(){\n                this.$api.addAddress(this.addressForm).then(res => {\n                    if (res.status_code === 1) {\n                        this.$message({\n                            message: '新增成功！',\n                            type: 'success'\n                        });\n                        this.selectedOptions = [];\n                        this.addressInfo = {\n                            consigneeName: '',\n                            consigneePhone: '',\n                            provinceName: '',\n                            cityName: '',\n                            regionName: '',\n                            detailAddress: '',\n                            defaultFlag: false\n                        };\n                        this.innerVisible = false;\n                        this.getAddressData();\n                    } else {\n                        this.$message.error('系统异常，新增失败！')\n                    }\n                }).catch(e => {\n                    this.$message.error('网络异常！')\n                })\n            },\n\n            handleSubmit(){\n\n            },\n            getCookie(cname){\n                var name = cname + \"=\";\n                var ca = document.cookie.split(';');\n                for(var i=0; i<ca.length; i++)\n                {\n                    var c = ca[i].trim();\n                    if (c.indexOf(name)===0) return c.substring(name.length,c.length);\n                }\n                return \"0\";\n            },\n            toDetails(id) {\n                this.$router.replace({path: 'details', query: {id: id}});\n            },\n            selectAddressDialog(){\n                if(this.orderInfo.userId==this.userId&&this.orderInfo.orderStatus===0){\n                    this.addressDialogVisible=true;\n                    if(this.addressData.length===0){\n                        this.getAddressData();\n                    }\n                }\n            },\n            getAddressData(){\n                this.$api.getAddress().then(res => {\n                    if (res.status_code === 1) {\n                        let data = res.data;\n                        for (let i = 0; i < data.length; i++) {\n                            data[i].detailAddressText = data[i].provinceName + data[i].cityName + data[i].regionName + data[i].detailAddress;\n                        }\n                        console.log(data);\n                        this.addressData = data;\n                        if(!this.addressInfo.update){\n                            for(let i=0;i<data.length;i++){\n                                if(data[i].defaultFlag){\n                                    this.selectAddress(i,data[i]);\n                                }\n                            }\n                        }\n                    }\n                })\n            },\n            selectAddress(i,item){\n                // this.addressDialogVisible=false;\n                console.log(item,this.addressInfo);\n                this.addressInfo.consigneeName=item.consigneeName;\n                this.addressInfo.consigneePhone=item.consigneePhone;\n                this.addressInfo.detailAddress=item.detailAddressText;\n                if(this.addressInfo.update){\n                    this.$api.updateOrderAddress({\n                        id:this.addressInfo.id,\n                        consigneeName:item.consigneeName,\n                        consigneePhone:item.consigneePhone,\n                        detailAddress:item.detailAddressText\n                    })\n                }else{\n                    this.$api.addOrderAddress({\n                        orderId:this.orderInfo.id,\n                        consigneeName:item.consigneeName,\n                        consigneePhone:item.consigneePhone,\n                        detailAddress:item.detailAddressText\n                    }).then(res=>{\n                        if(res.status_code===1){\n                            this.addressInfo.update=true;\n                            this.addressInfo.id=res.data.id;\n                        }else {\n                            this.$message.error(res.msg)\n                        }\n                    })\n                }\n\n            },\n            changeOrderStatus(orderStatus, orderInfo) {\n                if (orderStatus === 1) {\n                    console.log('zhifu');\n                    if(!this.addressInfo.detailAddress){\n                        this.$message.error('请选择地址！')\n                    }else{\n                        this.$confirm('模拟支付宝支付，是否确认支付', '支付订单', {\n                            confirmButtonText: '支付',\n                            cancelButtonText: '取消',\n                            type: 'warning'\n                        }).then(() => {\n                            var address = \"http://localhost:8080/alipay/pay?subject=\" + orderInfo.orderNumber+ \"&traceNo=\"+\n                                orderInfo.id + \"&totalAmount=\" + orderInfo.idleItem.idlePrice;\n\n                            // console.log(res.data[0]);\n                            // res.data.\n                            window.open(address)\n\n                        //     this.$api.updateOrder({\n                        //             id: orderInfo.id,\n                        //             orderStatus: orderStatus,\n                        //             paymentStatus: 1,\n                        //             paymentWay: '支付宝',\n                        //         }).then(res => {\n                        //             var address = \"http://localhost:8080/alipay/pay?name=\" + orderInfo.id + \"&no=\"+\n                        //               Math.random().toString(36).substr(2) + \"&price=\" + orderInfo.idleItem.idlePrice;\n                        //\n                        //             console.log(res.data[0]);\n                        //             // res.data.\n                        //             window.open(address)\n                        //\n                        //             if (res.status_code === 1) {\n                        //                 this.$message({\n                        //                     message: '支付成功！',\n                        //                     type: 'success'\n                        //                 });\n                        //                 this.orderInfo.orderStatus = orderStatus;\n                        //                 this.orderInfo.paymentStatus = 1;\n                        //                 this.orderInfo.paymentWay = '支付宝';\n                        //                 this.orderInfo.paymentTime = res.data.paymentTime;\n                        //             }\n                        //         })\n                        //\n                        // }).catch(() => {\n                        });\n                    }\n                } else {\n                    this.$api.updateOrder({\n                        id: orderInfo.id,\n                        orderStatus: orderStatus,\n                    }).then(res => {\n                        if (res.status_code === 1) {\n                            this.$message({\n                                message: '操作成功！',\n                                type: 'success'\n                            });\n                            this.orderInfo.orderStatus = orderStatus;\n                        }\n                    })\n                }\n            },\n        }\n\n    }\n",null]}