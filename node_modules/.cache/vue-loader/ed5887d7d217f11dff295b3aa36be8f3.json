{"remainingRequest":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/-Second-hand-mall/src/components/page/exchange-create.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/macos/Desktop/-Second-hand-mall/src/components/page/exchange-create.vue","mtime":1741935110794},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/babel-loader/lib/index.js","mtime":1741743640250},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js","mtime":1741743643788}],"contextDependencies":[],"result":["\nexport default {\n  name: 'ExchangeCreate',\n  data() {\n    return {\n      exchangeForm: {\n        requestItemId: '',\n        offerItemId: '',\n        exchangeReason: ''\n      },\n      rules: {\n        requestItemId: [\n          { required: true, message: '请选择要交换的物品', trigger: 'change' }\n        ],\n        offerItemId: [\n          { required: true, message: '请选择提供交换的物品', trigger: 'change' }\n        ],\n        exchangeReason: [\n          { required: true, message: '请输入交换理由', trigger: 'blur' },\n          { min: 5, max: 200, message: '长度在 5 到 200 个字符', trigger: 'blur' }\n        ]\n      },\n      requestItem: null,\n      offerItem: null,\n      itemSelectionDialogVisible: false,\n      dialogTitle: '',\n      currentSelectionType: '', // 'request' 或 'offer'\n      itemList: [],\n      searchKeyword: '',\n      currentPage: 1,\n      pageSize: 10,\n      totalItems: 0\n    };\n  },\n  methods: {\n    // 显示物品选择对话框\n    showItemSelectionDialog(type) {\n      this.currentSelectionType = type;\n      if (type === 'request') {\n        this.dialogTitle = '选择请求交换的物品';\n        // 加载其他用户的物品\n        this.loadOtherUserItems();\n      } else {\n        this.dialogTitle = '选择提供交换的物品';\n        // 加载当前用户的物品\n        this.loadMyItems();\n      }\n      this.itemSelectionDialogVisible = true;\n    },\n    \n    // 加载当前用户的物品\n    loadMyItems() {\n      this.$api.getMyIdleItems().then(res => {\n        if (res.status_code === 1) {\n          this.itemList = res.data;\n          this.totalItems = this.itemList.length;\n        } else {\n          this.$message.error(res.msg || '获取物品失败');\n        }\n      }).catch(err => {\n        console.error(err);\n        this.$message.error('获取物品失败');\n      });\n    },\n    \n    // 加载其他用户的物品\n    loadOtherUserItems() {\n      this.$api.findIdleItem(this.searchKeyword, this.currentPage, this.pageSize).then(res => {\n        if (res.status_code === 1) {\n          // 过滤掉自己的物品\n          this.itemList = res.data.list.filter(item => !this.isMyItem(item));\n          this.totalItems = res.data.total;\n        } else {\n          this.$message.error(res.msg || '获取物品失败');\n        }\n      }).catch(err => {\n        console.error(err);\n        this.$message.error('获取物品失败');\n      });\n    },\n    \n    // 判断是否是自己的物品\n    isMyItem(item) {\n      return item.userId === this.$globalData.userInfo.id;\n    },\n    \n    // 搜索物品\n    searchItems() {\n      this.currentPage = 1;\n      if (this.currentSelectionType === 'request') {\n        this.loadOtherUserItems();\n      } else {\n        // 本地过滤自己的物品\n        this.loadMyItems();\n      }\n    },\n    \n    // 选择物品\n    selectItem(item) {\n      if (this.currentSelectionType === 'request') {\n        this.requestItem = item;\n        this.exchangeForm.requestItemId = item.id;\n      } else {\n        this.offerItem = item;\n        this.exchangeForm.offerItemId = item.id;\n      }\n      this.itemSelectionDialogVisible = false;\n    },\n    \n    // 处理分页\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      if (this.currentSelectionType === 'request') {\n        this.loadOtherUserItems();\n      }\n    },\n    \n    // 提交交换请求\n    submitExchangeRequest() {\n      this.$refs.exchangeForm.validate(valid => {\n        if (valid) {\n          // 检查是否选择了相同的物品\n          if (this.exchangeForm.requestItemId === this.exchangeForm.offerItemId) {\n            this.$message.error('不能选择相同的物品进行交换');\n            return;\n          }\n          \n          this.$api.createExchangeRequest(this.exchangeForm).then(res => {\n            if (res.status_code === 1) {\n              this.$message.success(res.msg || '交换请求已发送');\n              this.goBack();\n            } else {\n              this.$message.error(res.msg || '发送交换请求失败');\n            }\n          }).catch(err => {\n            console.error(err);\n            this.$message.error('发送交换请求失败');\n          });\n        } else {\n          this.$message.error('请完善表单信息');\n          return false;\n        }\n      });\n    },\n    \n    // 返回上一页\n    goBack() {\n      this.$router.push('/exchange');\n    }\n  },\n  created() {\n    // 检查是否有从物品详情页传递的参数\n    if (this.$route.query.requestItemId) {\n      const requestItemId = this.$route.query.requestItemId;\n      // 获取物品详情\n      this.$api.getIdleItem(requestItemId).then(res => {\n        if (res.status_code === 1) {\n          this.requestItem = res.data;\n          this.exchangeForm.requestItemId = requestItemId;\n        } else {\n          this.$message.error(res.msg || '获取物品信息失败');\n        }\n      }).catch(err => {\n        console.error(err);\n        this.$message.error('获取物品信息失败');\n      });\n    }\n  }\n};\n",{"version":3,"sources":["exchange-create.vue"],"names":[],"mappings":";AA+FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"exchange-create.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\n  <div>\n    <div class=\"crumbs\">\n      <el-breadcrumb separator=\"/\">\n        <el-breadcrumb-item>\n          <i class=\"el-icon-lx-cascades\"></i> 发起交换请求\n        </el-breadcrumb-item>\n      </el-breadcrumb>\n    </div>\n    <div class=\"container\">\n      <div class=\"form-container\">\n        <h2>发起物品交换请求</h2>\n        <el-form ref=\"exchangeForm\" :model=\"exchangeForm\" :rules=\"rules\" label-width=\"120px\">\n          <el-form-item label=\"请求交换的物品\" prop=\"requestItemId\">\n            <div v-if=\"requestItem\">\n              <div class=\"selected-item\">\n                <img :src=\"requestItem.idleImg.split(',')[0]\" class=\"item-image\">\n                <div class=\"item-info\">\n                  <h3>{{ requestItem.idleName }}</h3>\n                  <p>价格: ¥{{ requestItem.idlePrice }}</p>\n                  <p>卖家: {{ requestItem.user ? requestItem.user.nickname : '' }}</p>\n                </div>\n              </div>\n            </div>\n            <el-button type=\"primary\" @click=\"showItemSelectionDialog('request')\">选择物品</el-button>\n          </el-form-item>\n          \n          <el-form-item label=\"提供交换的物品\" prop=\"offerItemId\">\n            <div v-if=\"offerItem\">\n              <div class=\"selected-item\">\n                <img :src=\"offerItem.idleImg.split(',')[0]\" class=\"item-image\">\n                <div class=\"item-info\">\n                  <h3>{{ offerItem.idleName }}</h3>\n                  <p>价格: ¥{{ offerItem.idlePrice }}</p>\n                </div>\n              </div>\n            </div>\n            <el-button type=\"primary\" @click=\"showItemSelectionDialog('offer')\">选择物品</el-button>\n          </el-form-item>\n          \n          <el-form-item label=\"交换理由\" prop=\"exchangeReason\">\n            <el-input type=\"textarea\" v-model=\"exchangeForm.exchangeReason\" rows=\"4\" placeholder=\"请输入交换理由，说明为什么想要交换这个物品\"></el-input>\n          </el-form-item>\n          \n          <el-form-item>\n            <el-button type=\"primary\" @click=\"submitExchangeRequest\">提交交换请求</el-button>\n            <el-button @click=\"goBack\">返回</el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n    </div>\n    \n    <!-- 物品选择对话框 -->\n    <el-dialog :title=\"dialogTitle\" :visible.sync=\"itemSelectionDialogVisible\" width=\"70%\">\n      <div class=\"search-container\">\n        <el-input v-model=\"searchKeyword\" placeholder=\"搜索物品\" class=\"search-input\">\n          <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"searchItems\"></el-button>\n        </el-input>\n      </div>\n      \n      <el-table :data=\"itemList\" style=\"width: 100%\" height=\"400px\">\n        <el-table-column prop=\"id\" label=\"ID\" width=\"80\"></el-table-column>\n        <el-table-column label=\"物品图片\" width=\"120\">\n          <template slot-scope=\"scope\">\n            <img :src=\"scope.row.idleImg.split(',')[0]\" style=\"width: 80px; height: 80px; object-fit: cover;\">\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"idleName\" label=\"物品名称\" width=\"180\"></el-table-column>\n        <el-table-column prop=\"idlePrice\" label=\"价格\" width=\"100\">\n          <template slot-scope=\"scope\">\n            ¥{{ scope.row.idlePrice }}\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"idleDescribe\" label=\"描述\"></el-table-column>\n        <el-table-column label=\"操作\" width=\"120\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"mini\" type=\"primary\" @click=\"selectItem(scope.row)\">选择</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      \n      <div class=\"pagination-container\">\n        <el-pagination\n          @current-change=\"handleCurrentChange\"\n          :current-page=\"currentPage\"\n          :page-size=\"pageSize\"\n          layout=\"total, prev, pager, next\"\n          :total=\"totalItems\">\n        </el-pagination>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'ExchangeCreate',\n  data() {\n    return {\n      exchangeForm: {\n        requestItemId: '',\n        offerItemId: '',\n        exchangeReason: ''\n      },\n      rules: {\n        requestItemId: [\n          { required: true, message: '请选择要交换的物品', trigger: 'change' }\n        ],\n        offerItemId: [\n          { required: true, message: '请选择提供交换的物品', trigger: 'change' }\n        ],\n        exchangeReason: [\n          { required: true, message: '请输入交换理由', trigger: 'blur' },\n          { min: 5, max: 200, message: '长度在 5 到 200 个字符', trigger: 'blur' }\n        ]\n      },\n      requestItem: null,\n      offerItem: null,\n      itemSelectionDialogVisible: false,\n      dialogTitle: '',\n      currentSelectionType: '', // 'request' 或 'offer'\n      itemList: [],\n      searchKeyword: '',\n      currentPage: 1,\n      pageSize: 10,\n      totalItems: 0\n    };\n  },\n  methods: {\n    // 显示物品选择对话框\n    showItemSelectionDialog(type) {\n      this.currentSelectionType = type;\n      if (type === 'request') {\n        this.dialogTitle = '选择请求交换的物品';\n        // 加载其他用户的物品\n        this.loadOtherUserItems();\n      } else {\n        this.dialogTitle = '选择提供交换的物品';\n        // 加载当前用户的物品\n        this.loadMyItems();\n      }\n      this.itemSelectionDialogVisible = true;\n    },\n    \n    // 加载当前用户的物品\n    loadMyItems() {\n      this.$api.getMyIdleItems().then(res => {\n        if (res.status_code === 1) {\n          this.itemList = res.data;\n          this.totalItems = this.itemList.length;\n        } else {\n          this.$message.error(res.msg || '获取物品失败');\n        }\n      }).catch(err => {\n        console.error(err);\n        this.$message.error('获取物品失败');\n      });\n    },\n    \n    // 加载其他用户的物品\n    loadOtherUserItems() {\n      this.$api.findIdleItem(this.searchKeyword, this.currentPage, this.pageSize).then(res => {\n        if (res.status_code === 1) {\n          // 过滤掉自己的物品\n          this.itemList = res.data.list.filter(item => !this.isMyItem(item));\n          this.totalItems = res.data.total;\n        } else {\n          this.$message.error(res.msg || '获取物品失败');\n        }\n      }).catch(err => {\n        console.error(err);\n        this.$message.error('获取物品失败');\n      });\n    },\n    \n    // 判断是否是自己的物品\n    isMyItem(item) {\n      return item.userId === this.$globalData.userInfo.id;\n    },\n    \n    // 搜索物品\n    searchItems() {\n      this.currentPage = 1;\n      if (this.currentSelectionType === 'request') {\n        this.loadOtherUserItems();\n      } else {\n        // 本地过滤自己的物品\n        this.loadMyItems();\n      }\n    },\n    \n    // 选择物品\n    selectItem(item) {\n      if (this.currentSelectionType === 'request') {\n        this.requestItem = item;\n        this.exchangeForm.requestItemId = item.id;\n      } else {\n        this.offerItem = item;\n        this.exchangeForm.offerItemId = item.id;\n      }\n      this.itemSelectionDialogVisible = false;\n    },\n    \n    // 处理分页\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      if (this.currentSelectionType === 'request') {\n        this.loadOtherUserItems();\n      }\n    },\n    \n    // 提交交换请求\n    submitExchangeRequest() {\n      this.$refs.exchangeForm.validate(valid => {\n        if (valid) {\n          // 检查是否选择了相同的物品\n          if (this.exchangeForm.requestItemId === this.exchangeForm.offerItemId) {\n            this.$message.error('不能选择相同的物品进行交换');\n            return;\n          }\n          \n          this.$api.createExchangeRequest(this.exchangeForm).then(res => {\n            if (res.status_code === 1) {\n              this.$message.success(res.msg || '交换请求已发送');\n              this.goBack();\n            } else {\n              this.$message.error(res.msg || '发送交换请求失败');\n            }\n          }).catch(err => {\n            console.error(err);\n            this.$message.error('发送交换请求失败');\n          });\n        } else {\n          this.$message.error('请完善表单信息');\n          return false;\n        }\n      });\n    },\n    \n    // 返回上一页\n    goBack() {\n      this.$router.push('/exchange');\n    }\n  },\n  created() {\n    // 检查是否有从物品详情页传递的参数\n    if (this.$route.query.requestItemId) {\n      const requestItemId = this.$route.query.requestItemId;\n      // 获取物品详情\n      this.$api.getIdleItem(requestItemId).then(res => {\n        if (res.status_code === 1) {\n          this.requestItem = res.data;\n          this.exchangeForm.requestItemId = requestItemId;\n        } else {\n          this.$message.error(res.msg || '获取物品信息失败');\n        }\n      }).catch(err => {\n        console.error(err);\n        this.$message.error('获取物品信息失败');\n      });\n    }\n  }\n};\n</script>\n\n<style scoped>\n.container {\n  padding: 20px;\n  background-color: #fff;\n  border-radius: 5px;\n}\n.form-container {\n  max-width: 800px;\n  margin: 0 auto;\n}\n.selected-item {\n  display: flex;\n  margin-bottom: 15px;\n  padding: 10px;\n  border: 1px solid #ebeef5;\n  border-radius: 5px;\n}\n.item-image {\n  width: 100px;\n  height: 100px;\n  object-fit: cover;\n  border-radius: 5px;\n  margin-right: 15px;\n}\n.item-info {\n  flex: 1;\n}\n.item-info h3 {\n  margin-top: 0;\n  margin-bottom: 10px;\n}\n.search-container {\n  margin-bottom: 20px;\n}\n.search-input {\n  width: 300px;\n}\n.pagination-container {\n  margin-top: 20px;\n  text-align: center;\n}\n</style> "]}]}