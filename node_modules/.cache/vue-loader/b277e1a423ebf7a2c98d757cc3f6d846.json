{"remainingRequest":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/-Second-hand-mall/src/components/page/donation-index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/macos/Desktop/-Second-hand-mall/src/components/page/donation-index.vue","mtime":1742008404562},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/babel-loader/lib/index.js","mtime":1741743640250},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js","mtime":1741743643788}],"contextDependencies":[],"result":["\nimport AppHead from '../common/AppHeader.vue';\nimport AppBody from '../common/AppPageBody.vue';\nimport AppFoot from '../common/AppFoot.vue';\n\nexport default {\n  name: 'donation-index',\n  components: {\n    AppHead,\n    AppBody,\n    AppFoot\n  },\n  data() {\n    return {\n      loading: false,\n      myItems: [],\n      donationDialogVisible: false,\n      selectedItem: null,\n      submitLoading: false,\n      donationForm: {\n        itemId: '',\n        donationType: 0,\n        donationReason: ''\n      },\n      donationRules: {\n        donationType: [\n          { required: true, message: '请选择捐赠类型', trigger: 'change' }\n        ],\n        donationReason: [\n          { required: true, message: '请输入捐赠理由', trigger: 'blur' },\n          { min: 5, max: 200, message: '长度在 5 到 200 个字符', trigger: 'blur' }\n        ]\n      }\n    };\n  },\n  created() {\n    this.loadMyItems();\n  },\n  methods: {\n    loadMyItems() {\n      this.loading = true;\n      this.$api.getAllIdleItem().then(res => {\n        if (res.status_code === 1 && res.data) {\n          // 过滤出在售状态的物品\n          this.myItems = res.data.filter(item => item.idleStatus === 1);\n        } else {\n          this.myItems = [];\n        }\n      }).catch(err => {\n        console.error('获取我的物品失败', err);\n        this.$message.error('获取我的物品失败');\n      }).finally(() => {\n        this.loading = false;\n      });\n    },\n    donateItem(item) {\n      this.selectedItem = item;\n      this.donationForm.itemId = item.id;\n      this.donationDialogVisible = true;\n    },\n    submitDonationRequest() {\n      this.$refs.donationForm.validate((valid) => {\n        if (valid) {\n          this.submitLoading = true;\n          this.$api.createDonationRequest({\n            itemId: this.donationForm.itemId,\n            donationType: this.donationForm.donationType,\n            donationReason: this.donationForm.donationReason\n          }).then(res => {\n            if (res.status_code === 1) {\n              this.$message.success('捐赠请求已提交');\n              this.donationDialogVisible = false;\n              \n              // 清空表单\n              this.donationForm.donationType = 0;\n              this.donationForm.donationReason = '';\n              \n              // 更新物品状态\n              this.loadMyItems();\n              \n            } else {\n              this.$message.error(res.msg || '提交捐赠请求失败');\n            }\n          }).catch(err => {\n            console.error('提交捐赠请求失败', err);\n            this.$message.error('提交捐赠请求失败');\n          }).finally(() => {\n            this.submitLoading = false;\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    viewItemDetail(itemId) {\n      this.$router.push({\n        path: '/details',\n        query: { id: itemId }\n      });\n    },\n    goToMyRequests() {\n      this.$router.push('/donation/my-requests');\n    },\n    goToRelease() {\n      this.$router.push('/release');\n    },\n    scrollToMyItems() {\n      const element = document.getElementById('my-items');\n      if (element) {\n        element.scrollIntoView({ behavior: 'smooth' });\n      }\n    },\n    getImageUrl(url) {\n      // 检查url是否已经是HTTP URL\n      if (url && (url.startsWith('http://') || url.startsWith('https://'))) {\n        return url;\n      }\n      \n      // 检查url是否是一个本地文件路径\n      if (url && (url.startsWith('/') || url.startsWith('D:') || url.includes('\\\\') || url.includes('/'))) {\n        // 如果是本地路径，则转换为服务器URL\n        // 这里假设文件名是路径最后的部分\n        const fileName = url.split(/[/\\\\]/).pop();\n        // 构建访问URL\n        return `http://localhost:8082/image?imageName=${fileName}`;\n      }\n      \n      // 如果是简单的文件名，直接构建访问URL\n      if (url && url.trim() !== '') {\n        return `http://localhost:8082/image?imageName=${url}`;\n      }\n      \n      // 其他情况直接返回\n      return url;\n    }\n  }\n};\n",{"version":3,"sources":["donation-index.vue"],"names":[],"mappings":";AAgJA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"donation-index.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\n  <div>\n    <app-head></app-head>\n    <app-body>\n      <div class=\"donation-container\">\n        <div class=\"donation-banner\">\n          <div class=\"banner-content\">\n            <h1>爱心捐赠 · 环保回收</h1>\n            <p>让闲置物品发挥更大的价值，传递爱心，保护环境</p>\n            <el-button type=\"success\" @click=\"scrollToMyItems\">查看我的可捐赠物品</el-button>\n            <el-button type=\"primary\" @click=\"goToMyRequests\">我的捐赠记录</el-button>\n          </div>\n        </div>\n        \n        <div class=\"donation-intro\">\n          <el-row :gutter=\"20\">\n            <el-col :span=\"12\">\n              <div class=\"intro-card\">\n                <div class=\"intro-icon\">\n                  <i class=\"el-icon-star-on\"></i>\n                </div>\n                <div class=\"intro-content\">\n                  <h3>公益捐赠</h3>\n                  <p>您的闲置物品将被捐赠给有需要的人或公益组织，传递爱心，帮助他人。</p>\n                  <p>适合：衣物、书籍、玩具、电子产品等保存完好的物品</p>\n                </div>\n              </div>\n            </el-col>\n            <el-col :span=\"12\">\n              <div class=\"intro-card\">\n                <div class=\"intro-icon\">\n                  <i class=\"el-icon-delete\"></i>\n                </div>\n                <div class=\"intro-content\">\n                  <h3>环保回收</h3>\n                  <p>闲置物品将被专业回收处理，减少资源浪费，保护环境。</p>\n                  <p>适合：旧电器、废纸、塑料、金属等可回收物品</p>\n                </div>\n              </div>\n            </el-col>\n          </el-row>\n        </div>\n        \n        <div class=\"donation-process\">\n          <h2>捐赠流程</h2>\n          <el-steps :active=\"4\" finish-status=\"success\" align-center>\n            <el-step title=\"选择物品\" description=\"从您的闲置物品中选择\"></el-step>\n            <el-step title=\"提交申请\" description=\"填写捐赠理由和类型\"></el-step>\n            <el-step title=\"等待审核\" description=\"工作人员会尽快审核\"></el-step>\n            <el-step title=\"完成捐赠\" description=\"物品将被妥善处理\"></el-step>\n          </el-steps>\n        </div>\n        \n        <div id=\"my-items\" class=\"my-items-section\">\n          <h2>我的可捐赠物品</h2>\n          <div v-loading=\"loading\">\n            <div v-if=\"myItems.length === 0\" class=\"empty-items\">\n              <i class=\"el-icon-goods\"></i>\n              <p>您暂无可捐赠的物品</p>\n              <el-button type=\"primary\" @click=\"goToRelease\">发布闲置物品</el-button>\n            </div>\n            \n            <el-row :gutter=\"20\">\n              <el-col :xs=\"24\" :sm=\"12\" :md=\"8\" :lg=\"6\" v-for=\"item in myItems\" :key=\"item.id\">\n                <el-card class=\"item-card\" shadow=\"hover\">\n                  <div class=\"item-image\">\n                    <img :src=\"getImageUrl(item.pictureList[0])\" alt=\"物品图片\">\n                  </div>\n                  <div class=\"item-info\">\n                    <h3 class=\"item-name\">{{ item.idleName }}</h3>\n                    <div class=\"item-price\">¥{{ item.idlePrice }}</div>\n                    <div class=\"item-status\">\n                      <el-tag size=\"small\" type=\"success\" v-if=\"item.idleStatus === 1\">在售</el-tag>\n                      <el-tag size=\"small\" type=\"info\" v-else-if=\"item.idleStatus === 2\">已下架</el-tag>\n                      <el-tag size=\"small\" type=\"warning\" v-else>其他状态</el-tag>\n                    </div>\n                    <div class=\"item-actions\">\n                      <el-button type=\"success\" size=\"small\" @click=\"donateItem(item)\" :disabled=\"item.idleStatus !== 1\">捐赠</el-button>\n                      <el-button type=\"primary\" size=\"small\" @click=\"viewItemDetail(item.id)\">查看详情</el-button>\n                    </div>\n                  </div>\n                </el-card>\n              </el-col>\n            </el-row>\n          </div>\n        </div>\n      </div>\n    </app-body>\n    <app-foot></app-foot>\n    \n    <!-- 捐赠弹窗 -->\n    <el-dialog\n      title=\"爱心捐赠\"\n      :visible.sync=\"donationDialogVisible\"\n      width=\"50%\">\n      <el-form :model=\"donationForm\" :rules=\"donationRules\" ref=\"donationForm\" label-width=\"120px\">\n        <el-form-item label=\"捐赠物品\" prop=\"itemId\">\n          <div class=\"donation-preview-item\">\n            <div v-if=\"selectedItem\">\n              <div class=\"item-preview\">\n                <img :src=\"getImageUrl(selectedItem.pictureList[0])\" class=\"preview-img\">\n                <div class=\"item-info\">\n                  <div class=\"item-name\">{{ selectedItem.idleName }}</div>\n                  <div class=\"item-price\">¥{{ selectedItem.idlePrice }}</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </el-form-item>\n        \n        <el-form-item label=\"捐赠类型\" prop=\"donationType\">\n          <el-radio-group v-model=\"donationForm.donationType\">\n            <el-radio :label=\"0\">公益捐赠</el-radio>\n            <el-radio :label=\"1\">环保回收</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        \n        <el-form-item label=\"捐赠理由\" prop=\"donationReason\">\n          <el-input\n            type=\"textarea\"\n            :rows=\"4\"\n            placeholder=\"请输入捐赠理由，说明为什么想要捐赠这个物品\"\n            v-model=\"donationForm.donationReason\">\n          </el-input>\n        </el-form-item>\n      </el-form>\n      \n      <div class=\"donation-notes\">\n        <p><i class=\"el-icon-info\"></i> 捐赠说明：</p>\n        <p>1. 公益捐赠：您的物品将捐赠给有需要的人或公益组织</p>\n        <p>2. 环保回收：闲置物品将被环保回收，减少资源浪费</p>\n        <p>3. 捐赠成功后，物品将自动下架</p>\n        <p>4. 捐赠后可能有工作人员与您联系，请保持联系方式畅通</p>\n      </div>\n      \n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"donationDialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitDonationRequest\" :loading=\"submitLoading\">提交捐赠</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport AppHead from '../common/AppHeader.vue';\nimport AppBody from '../common/AppPageBody.vue';\nimport AppFoot from '../common/AppFoot.vue';\n\nexport default {\n  name: 'donation-index',\n  components: {\n    AppHead,\n    AppBody,\n    AppFoot\n  },\n  data() {\n    return {\n      loading: false,\n      myItems: [],\n      donationDialogVisible: false,\n      selectedItem: null,\n      submitLoading: false,\n      donationForm: {\n        itemId: '',\n        donationType: 0,\n        donationReason: ''\n      },\n      donationRules: {\n        donationType: [\n          { required: true, message: '请选择捐赠类型', trigger: 'change' }\n        ],\n        donationReason: [\n          { required: true, message: '请输入捐赠理由', trigger: 'blur' },\n          { min: 5, max: 200, message: '长度在 5 到 200 个字符', trigger: 'blur' }\n        ]\n      }\n    };\n  },\n  created() {\n    this.loadMyItems();\n  },\n  methods: {\n    loadMyItems() {\n      this.loading = true;\n      this.$api.getAllIdleItem().then(res => {\n        if (res.status_code === 1 && res.data) {\n          // 过滤出在售状态的物品\n          this.myItems = res.data.filter(item => item.idleStatus === 1);\n        } else {\n          this.myItems = [];\n        }\n      }).catch(err => {\n        console.error('获取我的物品失败', err);\n        this.$message.error('获取我的物品失败');\n      }).finally(() => {\n        this.loading = false;\n      });\n    },\n    donateItem(item) {\n      this.selectedItem = item;\n      this.donationForm.itemId = item.id;\n      this.donationDialogVisible = true;\n    },\n    submitDonationRequest() {\n      this.$refs.donationForm.validate((valid) => {\n        if (valid) {\n          this.submitLoading = true;\n          this.$api.createDonationRequest({\n            itemId: this.donationForm.itemId,\n            donationType: this.donationForm.donationType,\n            donationReason: this.donationForm.donationReason\n          }).then(res => {\n            if (res.status_code === 1) {\n              this.$message.success('捐赠请求已提交');\n              this.donationDialogVisible = false;\n              \n              // 清空表单\n              this.donationForm.donationType = 0;\n              this.donationForm.donationReason = '';\n              \n              // 更新物品状态\n              this.loadMyItems();\n              \n            } else {\n              this.$message.error(res.msg || '提交捐赠请求失败');\n            }\n          }).catch(err => {\n            console.error('提交捐赠请求失败', err);\n            this.$message.error('提交捐赠请求失败');\n          }).finally(() => {\n            this.submitLoading = false;\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    viewItemDetail(itemId) {\n      this.$router.push({\n        path: '/details',\n        query: { id: itemId }\n      });\n    },\n    goToMyRequests() {\n      this.$router.push('/donation/my-requests');\n    },\n    goToRelease() {\n      this.$router.push('/release');\n    },\n    scrollToMyItems() {\n      const element = document.getElementById('my-items');\n      if (element) {\n        element.scrollIntoView({ behavior: 'smooth' });\n      }\n    },\n    getImageUrl(url) {\n      // 检查url是否已经是HTTP URL\n      if (url && (url.startsWith('http://') || url.startsWith('https://'))) {\n        return url;\n      }\n      \n      // 检查url是否是一个本地文件路径\n      if (url && (url.startsWith('/') || url.startsWith('D:') || url.includes('\\\\') || url.includes('/'))) {\n        // 如果是本地路径，则转换为服务器URL\n        // 这里假设文件名是路径最后的部分\n        const fileName = url.split(/[/\\\\]/).pop();\n        // 构建访问URL\n        return `http://localhost:8082/image?imageName=${fileName}`;\n      }\n      \n      // 如果是简单的文件名，直接构建访问URL\n      if (url && url.trim() !== '') {\n        return `http://localhost:8082/image?imageName=${url}`;\n      }\n      \n      // 其他情况直接返回\n      return url;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.donation-container {\n  min-height: 80vh;\n}\n\n.donation-banner {\n  height: 300px;\n  background: linear-gradient(135deg, #67C23A 0%, #409EFF 100%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  text-align: center;\n  margin-bottom: 40px;\n}\n\n.banner-content h1 {\n  font-size: 36px;\n  margin-bottom: 20px;\n}\n\n.banner-content p {\n  font-size: 18px;\n  margin-bottom: 30px;\n}\n\n.donation-intro {\n  margin-bottom: 40px;\n}\n\n.intro-card {\n  display: flex;\n  background-color: #f8f8f8;\n  border-radius: 8px;\n  padding: 20px;\n  height: 100%;\n}\n\n.intro-icon {\n  font-size: 48px;\n  margin-right: 20px;\n  color: #409EFF;\n}\n\n.intro-icon .el-icon-star-on {\n  color: #E6A23C;\n}\n\n.intro-icon .el-icon-delete {\n  color: #67C23A;\n}\n\n.intro-content h3 {\n  margin-top: 0;\n  margin-bottom: 15px;\n  font-size: 20px;\n}\n\n.donation-process {\n  margin-bottom: 40px;\n  text-align: center;\n}\n\n.donation-process h2 {\n  margin-bottom: 30px;\n}\n\n.my-items-section {\n  margin-bottom: 40px;\n}\n\n.my-items-section h2 {\n  margin-bottom: 20px;\n}\n\n.item-card {\n  margin-bottom: 20px;\n  height: 100%;\n}\n\n.item-image {\n  height: 200px;\n  overflow: hidden;\n}\n\n.item-image img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.item-info {\n  padding: 15px 0;\n}\n\n.item-name {\n  margin: 0 0 10px 0;\n  font-size: 16px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.item-price {\n  color: #F56C6C;\n  font-size: 16px;\n  font-weight: bold;\n  margin-bottom: 10px;\n}\n\n.item-status {\n  margin-bottom: 15px;\n}\n\n.item-actions {\n  display: flex;\n  justify-content: space-between;\n}\n\n.empty-items {\n  text-align: center;\n  padding: 50px 0;\n  color: #909399;\n}\n\n.empty-items i {\n  font-size: 48px;\n  margin-bottom: 20px;\n}\n\n.empty-items p {\n  margin-bottom: 20px;\n}\n\n.donation-preview-item {\n  margin-bottom: 15px;\n}\n\n.item-preview {\n  display: flex;\n  align-items: center;\n}\n\n.preview-img {\n  width: 80px;\n  height: 80px;\n  object-fit: cover;\n  border-radius: 4px;\n  margin-right: 15px;\n}\n\n.donation-notes {\n  background-color: #f8f8f8;\n  padding: 15px;\n  border-radius: 4px;\n  margin-top: 20px;\n  font-size: 14px;\n  color: #606266;\n}\n\n.donation-notes p {\n  margin: 5px 0;\n}\n\n.donation-notes i {\n  color: #E6A23C;\n  margin-right: 5px;\n}\n</style> "]}]}