{"remainingRequest":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/-Second-hand-mall/src/components/common/AnnouncementManagement.vue?vue&type=style&index=0&id=72a86264&scoped=true&lang=css","dependencies":[{"path":"/Users/macos/Desktop/-Second-hand-mall/src/components/common/AnnouncementManagement.vue","mtime":1742200494767},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/css-loader/index.js","mtime":1741743640772},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1741743643789},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/postcss-loader/src/index.js","mtime":1741743642507},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js","mtime":1741743643788}],"contextDependencies":[],"result":["\n.announcement-management {\n  padding: 20px;\n}\n\n.management-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.management-header h3 {\n  margin: 0;\n}\n\n.pagination-container {\n  margin-top: 20px;\n  text-align: right;\n}\n\n.announcement-meta {\n  margin: 10px 0 20px;\n  color: #606266;\n  font-size: 14px;\n}\n\n.announcement-meta span {\n  margin-right: 15px;\n}\n\n.announcement-content {\n  margin-top: 20px;\n  line-height: 1.6;\n}\n",{"version":3,"sources":["AnnouncementManagement.vue"],"names":[],"mappings":";AAkQA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"AnnouncementManagement.vue","sourceRoot":"src/components/common","sourcesContent":["<template>\n  <div class=\"announcement-management\">\n    <div class=\"management-header\">\n      <h3>公告管理</h3>\n      <el-button type=\"primary\" @click=\"createAnnouncement\">创建公告</el-button>\n    </div>\n    \n    <el-tabs v-model=\"activeTab\" @tab-click=\"handleTabClick\">\n      <el-tab-pane label=\"全部公告\" name=\"all\"></el-tab-pane>\n      <el-tab-pane label=\"已发布\" name=\"published\"></el-tab-pane>\n      <el-tab-pane label=\"草稿\" name=\"draft\"></el-tab-pane>\n    </el-tabs>\n    \n    <el-table\n      :data=\"announcementList\"\n      style=\"width: 100%\"\n      v-loading=\"loading\"\n      border>\n      <el-table-column\n        prop=\"id\"\n        label=\"ID\"\n        width=\"80\">\n      </el-table-column>\n      <el-table-column\n        prop=\"title\"\n        label=\"标题\"\n        min-width=\"200\">\n      </el-table-column>\n      <el-table-column\n        label=\"状态\"\n        width=\"100\">\n        <template slot-scope=\"scope\">\n          <el-tag :type=\"getStatusType(scope.row.status)\">\n            {{ getStatusText(scope.row.status) }}\n          </el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column\n        label=\"重要\"\n        width=\"80\">\n        <template slot-scope=\"scope\">\n          <el-tag type=\"danger\" v-if=\"scope.row.important === 1\">重要</el-tag>\n          <span v-else>-</span>\n        </template>\n      </el-table-column>\n      <el-table-column\n        prop=\"create_time\"\n        label=\"创建时间\"\n        width=\"180\">\n        <template slot-scope=\"scope\">\n          {{ formatDate(scope.row.create_time) }}\n        </template>\n      </el-table-column>\n      <el-table-column\n        prop=\"publish_time\"\n        label=\"发布时间\"\n        width=\"180\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.publish_time ? formatDate(scope.row.publish_time) : '-' }}\n        </template>\n      </el-table-column>\n      <el-table-column\n        label=\"操作\"\n        width=\"200\">\n        <template slot-scope=\"scope\">\n          <el-button\n            size=\"mini\"\n            @click=\"viewAnnouncement(scope.row.id)\">查看</el-button>\n          <el-button\n            size=\"mini\"\n            type=\"primary\"\n            @click=\"editAnnouncement(scope.row.id)\">编辑</el-button>\n          <el-button\n            size=\"mini\"\n            type=\"danger\"\n            @click=\"deleteAnnouncement(scope.row.id)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    \n    <div class=\"pagination-container\">\n      <el-pagination\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"currentPage\"\n        :page-sizes=\"[10, 20, 30, 50]\"\n        :page-size=\"pageSize\"\n        layout=\"total, sizes, prev, pager, next, jumper\"\n        :total=\"total\">\n      </el-pagination>\n    </div>\n    \n    <!-- 公告详情对话框 -->\n    <el-dialog title=\"公告详情\" :visible.sync=\"dialogVisible\" width=\"60%\">\n      <div v-if=\"currentAnnouncement\">\n        <h2>{{ currentAnnouncement.title }}</h2>\n        <div class=\"announcement-meta\">\n          <span>状态: {{ getStatusText(currentAnnouncement.status) }}</span>\n          <span>创建时间: {{ formatDate(currentAnnouncement.create_time) }}</span>\n          <span v-if=\"currentAnnouncement.publish_time\">发布时间: {{ formatDate(currentAnnouncement.publish_time) }}</span>\n        </div>\n        <div class=\"announcement-content\" v-html=\"currentAnnouncement.content\"></div>\n      </div>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogVisible = false\">关闭</el-button>\n        <el-button type=\"primary\" @click=\"editAnnouncement(currentAnnouncement.id)\">编辑</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"AnnouncementManagement\",\n  data() {\n    return {\n      activeTab: 'all',\n      announcementList: [],\n      loading: false,\n      currentPage: 1,\n      pageSize: 10,\n      total: 0,\n      dialogVisible: false,\n      currentAnnouncement: null\n    };\n  },\n  created() {\n    this.fetchAnnouncementList();\n  },\n  methods: {\n    fetchAnnouncementList() {\n      this.loading = true;\n      const params = {\n        page: this.currentPage,\n        limit: this.pageSize\n      };\n      \n      // 根据选中的标签筛选状态\n      if (this.activeTab === 'published') {\n        params.status = 1; // 已发布\n      } else if (this.activeTab === 'draft') {\n        params.status = 0; // 草稿\n      }\n      \n      this.$api.getAnnouncementList(params)\n        .then(res => {\n          this.loading = false;\n          if (res.status_code === 1) {\n            this.announcementList = res.data.list || [];\n            this.total = res.data.total || 0;\n          } else {\n            this.$message.error(res.msg || '获取公告列表失败');\n          }\n        })\n        .catch(err => {\n          this.loading = false;\n          console.error(\"获取公告列表失败:\", err);\n          this.$message.error('获取公告列表失败');\n        });\n    },\n    \n    handleTabClick() {\n      this.currentPage = 1;\n      this.fetchAnnouncementList();\n    },\n    \n    handleSizeChange(val) {\n      this.pageSize = val;\n      this.fetchAnnouncementList();\n    },\n    \n    handleCurrentChange(val) {\n      this.currentPage = val;\n      this.fetchAnnouncementList();\n    },\n    \n    createAnnouncement() {\n      this.$router.push('/admin/announcement/create');\n    },\n    \n    viewAnnouncement(id) {\n      this.loading = true;\n      this.$api.getAnnouncementDetail({ id })\n        .then(res => {\n          this.loading = false;\n          if (res.status_code === 1) {\n            this.currentAnnouncement = res.data;\n            this.dialogVisible = true;\n          } else {\n            this.$message.error(res.msg || '获取公告详情失败');\n          }\n        })\n        .catch(err => {\n          this.loading = false;\n          console.error(\"获取公告详情失败:\", err);\n          this.$message.error('获取公告详情失败');\n        });\n    },\n    \n    editAnnouncement(id) {\n      this.$router.push(`/admin/announcement/edit/${id}`);\n    },\n    \n    deleteAnnouncement(id) {\n      this.$confirm('确定要删除该公告吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.loading = true;\n        this.$api.deleteAnnouncement({ id })\n          .then(res => {\n            this.loading = false;\n            if (res.status_code === 1) {\n              this.$message.success('删除成功');\n              this.fetchAnnouncementList();\n            } else {\n              this.$message.error(res.msg || '删除失败');\n            }\n          })\n          .catch(err => {\n            this.loading = false;\n            console.error(\"删除公告失败:\", err);\n            this.$message.error('删除失败');\n          });\n      }).catch(() => {\n        // 取消删除\n      });\n    },\n    \n    getStatusType(status) {\n      switch (status) {\n        case 0: return 'info';    // 草稿\n        case 1: return 'success'; // 已发布\n        case 2: return 'warning'; // 已过期\n        default: return 'info';\n      }\n    },\n    \n    getStatusText(status) {\n      switch (status) {\n        case 0: return '草稿';\n        case 1: return '已发布';\n        case 2: return '已过期';\n        default: return '未知';\n      }\n    },\n    \n    formatDate(timestamp) {\n      if (!timestamp) return '-';\n      const date = new Date(timestamp * 1000);\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.announcement-management {\n  padding: 20px;\n}\n\n.management-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.management-header h3 {\n  margin: 0;\n}\n\n.pagination-container {\n  margin-top: 20px;\n  text-align: right;\n}\n\n.announcement-meta {\n  margin: 10px 0 20px;\n  color: #606266;\n  font-size: 14px;\n}\n\n.announcement-meta span {\n  margin-right: 15px;\n}\n\n.announcement-content {\n  margin-top: 20px;\n  line-height: 1.6;\n}\n</style> "]}]}