{"remainingRequest":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/-Second-hand-mall/src/components/page/exchange/create-exchange.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/macos/Desktop/-Second-hand-mall/src/components/page/exchange/create-exchange.vue","mtime":1741936830649},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/babel-loader/lib/index.js","mtime":1741743640250},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js","mtime":1741743643788}],"contextDependencies":[],"result":["\nimport api from '@/api/index';\n\nexport default {\n  name: 'create-exchange',\n  data() {\n    return {\n      exchangeForm: {\n        requestItemId: '',\n        offerItemId: '',\n        itemOwnerId: '',\n        exchangeReason: ''\n      },\n      rules: {\n        requestItemId: [\n          { required: true, message: '请选择您想要交换的物品', trigger: 'change' }\n        ],\n        offerItemId: [\n          { required: true, message: '请选择您提供交换的物品', trigger: 'change' }\n        ],\n        exchangeReason: [\n          { required: true, message: '请输入交换理由', trigger: 'blur' },\n          { min: 5, max: 200, message: '长度在 5 到 200 个字符', trigger: 'blur' }\n        ]\n      },\n      targetItems: [],\n      myItems: [],\n      itemOwner: null,\n      loading: false\n    }\n  },\n  computed: {\n    selectedTargetItem() {\n      return this.targetItems.find(item => item.id === this.exchangeForm.requestItemId);\n    },\n    selectedMyItem() {\n      return this.myItems.find(item => item.id === this.exchangeForm.offerItemId);\n    }\n  },\n  mounted() {\n    this.loadTargetItems();\n    this.loadMyItems();\n  },\n  methods: {\n    loadTargetItems() {\n      this.loading = true;\n      api.getAllIdleItem({\n        page: 1,\n        nums: 100\n      }).then(res => {\n        if (res.data && res.data.list) {\n          // 过滤出在售状态的物品\n          this.targetItems = res.data.list.filter(item => item.idleStatus === 0);\n        }\n      }).catch(err => {\n        console.error('获取物品列表失败', err);\n        this.$message.error('获取物品列表失败');\n      }).finally(() => {\n        this.loading = false;\n      });\n    },\n    loadMyItems() {\n      api.checkMyIdle().then(res => {\n        if (res.data) {\n          // 过滤出在售状态的物品\n          this.myItems = res.data.filter(item => item.idleStatus === 0);\n        }\n      }).catch(err => {\n        console.error('获取我的物品失败', err);\n        this.$message.error('获取我的物品失败');\n      });\n    },\n    loadItemOwner() {\n      if (!this.exchangeForm.requestItemId) return;\n      \n      const selectedItem = this.targetItems.find(item => item.id === this.exchangeForm.requestItemId);\n      if (selectedItem) {\n        this.exchangeForm.itemOwnerId = selectedItem.userId;\n        \n        // 获取物品所有者信息\n        api.getUserInfo({\n          id: selectedItem.userId\n        }).then(res => {\n          if (res.data) {\n            this.itemOwner = res.data;\n          }\n        }).catch(err => {\n          console.error('获取用户信息失败', err);\n        });\n      }\n    },\n    getFirstImage(pictureList) {\n      if (!pictureList) return require('@/assets/img/default.png');\n      const images = pictureList.split(',');\n      return images[0] || require('@/assets/img/default.png');\n    },\n    submitForm(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          this.loading = true;\n          api.createExchangeRequest(this.exchangeForm).then(res => {\n            if (res.status_code === 1) {\n              this.$message.success('交换请求已发送');\n              this.$router.push('/exchange/my-requests');\n            } else {\n              this.$message.error(res.msg || '发送交换请求失败');\n            }\n          }).catch(err => {\n            console.error('发送交换请求失败', err);\n            this.$message.error('发送交换请求失败');\n          }).finally(() => {\n            this.loading = false;\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    goBack() {\n      this.$router.go(-1);\n    }\n  }\n}\n",{"version":3,"sources":["create-exchange.vue"],"names":[],"mappings":";AAoGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"create-exchange.vue","sourceRoot":"src/components/page/exchange","sourcesContent":["<template>\n  <div class=\"create-exchange-container\">\n    <el-card class=\"box-card\">\n      <div slot=\"header\" class=\"clearfix\">\n        <span class=\"title\">发起物品交换</span>\n      </div>\n      \n      <el-form :model=\"exchangeForm\" :rules=\"rules\" ref=\"exchangeForm\" label-width=\"120px\">\n        <el-form-item label=\"交换对象物品\" prop=\"requestItemId\">\n          <el-select v-model=\"exchangeForm.requestItemId\" placeholder=\"选择您想要交换的物品\" @change=\"loadItemOwner\">\n            <el-option\n              v-for=\"item in targetItems\"\n              :key=\"item.id\"\n              :label=\"item.idleName\"\n              :value=\"item.id\">\n              <div class=\"item-option\">\n                <img :src=\"getFirstImage(item.pictureList)\" class=\"item-img\">\n                <div class=\"item-info\">\n                  <div class=\"item-name\">{{ item.idleName }}</div>\n                  <div class=\"item-price\">¥{{ item.idlePrice }}</div>\n                </div>\n              </div>\n            </el-option>\n          </el-select>\n        </el-form-item>\n        \n        <el-form-item label=\"物品所有者\" v-if=\"itemOwner\">\n          <div class=\"owner-info\">\n            <img :src=\"itemOwner.userAvatar || require('@/assets/img/avatar.png')\" class=\"owner-avatar\">\n            <span class=\"owner-name\">{{ itemOwner.nickname }}</span>\n          </div>\n        </el-form-item>\n        \n        <el-form-item label=\"我的交换物品\" prop=\"offerItemId\">\n          <el-select v-model=\"exchangeForm.offerItemId\" placeholder=\"选择您提供交换的物品\">\n            <el-option\n              v-for=\"item in myItems\"\n              :key=\"item.id\"\n              :label=\"item.idleName\"\n              :value=\"item.id\">\n              <div class=\"item-option\">\n                <img :src=\"getFirstImage(item.pictureList)\" class=\"item-img\">\n                <div class=\"item-info\">\n                  <div class=\"item-name\">{{ item.idleName }}</div>\n                  <div class=\"item-price\">¥{{ item.idlePrice }}</div>\n                </div>\n              </div>\n            </el-option>\n          </el-select>\n        </el-form-item>\n        \n        <el-form-item label=\"交换理由\" prop=\"exchangeReason\">\n          <el-input\n            type=\"textarea\"\n            :rows=\"4\"\n            placeholder=\"请输入交换理由，向对方说明为什么想要交换这个物品\"\n            v-model=\"exchangeForm.exchangeReason\">\n          </el-input>\n        </el-form-item>\n        \n        <el-form-item>\n          <el-button type=\"primary\" @click=\"submitForm('exchangeForm')\">提交交换请求</el-button>\n          <el-button @click=\"goBack\">返回</el-button>\n        </el-form-item>\n      </el-form>\n      \n      <div class=\"preview-container\" v-if=\"exchangeForm.requestItemId && exchangeForm.offerItemId\">\n        <h3>交换预览</h3>\n        <el-divider></el-divider>\n        <div class=\"exchange-preview\">\n          <div class=\"preview-item\">\n            <h4>我将获得</h4>\n            <div class=\"item-card\" v-if=\"selectedTargetItem\">\n              <img :src=\"getFirstImage(selectedTargetItem.pictureList)\" class=\"preview-img\">\n              <div class=\"preview-info\">\n                <div class=\"preview-name\">{{ selectedTargetItem.idleName }}</div>\n                <div class=\"preview-price\">¥{{ selectedTargetItem.idlePrice }}</div>\n              </div>\n            </div>\n          </div>\n          <div class=\"exchange-arrow\">\n            <i class=\"el-icon-right\"></i>\n          </div>\n          <div class=\"preview-item\">\n            <h4>我将付出</h4>\n            <div class=\"item-card\" v-if=\"selectedMyItem\">\n              <img :src=\"getFirstImage(selectedMyItem.pictureList)\" class=\"preview-img\">\n              <div class=\"preview-info\">\n                <div class=\"preview-name\">{{ selectedMyItem.idleName }}</div>\n                <div class=\"preview-price\">¥{{ selectedMyItem.idlePrice }}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport api from '@/api/index';\n\nexport default {\n  name: 'create-exchange',\n  data() {\n    return {\n      exchangeForm: {\n        requestItemId: '',\n        offerItemId: '',\n        itemOwnerId: '',\n        exchangeReason: ''\n      },\n      rules: {\n        requestItemId: [\n          { required: true, message: '请选择您想要交换的物品', trigger: 'change' }\n        ],\n        offerItemId: [\n          { required: true, message: '请选择您提供交换的物品', trigger: 'change' }\n        ],\n        exchangeReason: [\n          { required: true, message: '请输入交换理由', trigger: 'blur' },\n          { min: 5, max: 200, message: '长度在 5 到 200 个字符', trigger: 'blur' }\n        ]\n      },\n      targetItems: [],\n      myItems: [],\n      itemOwner: null,\n      loading: false\n    }\n  },\n  computed: {\n    selectedTargetItem() {\n      return this.targetItems.find(item => item.id === this.exchangeForm.requestItemId);\n    },\n    selectedMyItem() {\n      return this.myItems.find(item => item.id === this.exchangeForm.offerItemId);\n    }\n  },\n  mounted() {\n    this.loadTargetItems();\n    this.loadMyItems();\n  },\n  methods: {\n    loadTargetItems() {\n      this.loading = true;\n      api.getAllIdleItem({\n        page: 1,\n        nums: 100\n      }).then(res => {\n        if (res.data && res.data.list) {\n          // 过滤出在售状态的物品\n          this.targetItems = res.data.list.filter(item => item.idleStatus === 0);\n        }\n      }).catch(err => {\n        console.error('获取物品列表失败', err);\n        this.$message.error('获取物品列表失败');\n      }).finally(() => {\n        this.loading = false;\n      });\n    },\n    loadMyItems() {\n      api.checkMyIdle().then(res => {\n        if (res.data) {\n          // 过滤出在售状态的物品\n          this.myItems = res.data.filter(item => item.idleStatus === 0);\n        }\n      }).catch(err => {\n        console.error('获取我的物品失败', err);\n        this.$message.error('获取我的物品失败');\n      });\n    },\n    loadItemOwner() {\n      if (!this.exchangeForm.requestItemId) return;\n      \n      const selectedItem = this.targetItems.find(item => item.id === this.exchangeForm.requestItemId);\n      if (selectedItem) {\n        this.exchangeForm.itemOwnerId = selectedItem.userId;\n        \n        // 获取物品所有者信息\n        api.getUserInfo({\n          id: selectedItem.userId\n        }).then(res => {\n          if (res.data) {\n            this.itemOwner = res.data;\n          }\n        }).catch(err => {\n          console.error('获取用户信息失败', err);\n        });\n      }\n    },\n    getFirstImage(pictureList) {\n      if (!pictureList) return require('@/assets/img/default.png');\n      const images = pictureList.split(',');\n      return images[0] || require('@/assets/img/default.png');\n    },\n    submitForm(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          this.loading = true;\n          api.createExchangeRequest(this.exchangeForm).then(res => {\n            if (res.status_code === 1) {\n              this.$message.success('交换请求已发送');\n              this.$router.push('/exchange/my-requests');\n            } else {\n              this.$message.error(res.msg || '发送交换请求失败');\n            }\n          }).catch(err => {\n            console.error('发送交换请求失败', err);\n            this.$message.error('发送交换请求失败');\n          }).finally(() => {\n            this.loading = false;\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    goBack() {\n      this.$router.go(-1);\n    }\n  }\n}\n</script>\n\n<style scoped>\n.create-exchange-container {\n  padding: 20px;\n}\n.title {\n  font-size: 22px;\n  font-weight: bold;\n  color: #409EFF;\n}\n.item-option {\n  display: flex;\n  align-items: center;\n}\n.item-img {\n  width: 40px;\n  height: 40px;\n  object-fit: cover;\n  margin-right: 10px;\n  border-radius: 4px;\n}\n.item-info {\n  display: flex;\n  flex-direction: column;\n}\n.item-name {\n  font-size: 14px;\n  color: #303133;\n}\n.item-price {\n  font-size: 12px;\n  color: #F56C6C;\n}\n.owner-info {\n  display: flex;\n  align-items: center;\n}\n.owner-avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  margin-right: 10px;\n}\n.owner-name {\n  font-size: 14px;\n  color: #303133;\n}\n.preview-container {\n  margin-top: 30px;\n}\n.exchange-preview {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 20px;\n}\n.preview-item {\n  flex: 1;\n  text-align: center;\n}\n.exchange-arrow {\n  font-size: 24px;\n  color: #409EFF;\n  margin: 0 20px;\n}\n.preview-img {\n  width: 100px;\n  height: 100px;\n  object-fit: cover;\n  border-radius: 4px;\n  margin-bottom: 10px;\n}\n.preview-info {\n  text-align: center;\n}\n.preview-name {\n  font-size: 14px;\n  color: #303133;\n  margin-bottom: 5px;\n}\n.preview-price {\n  font-size: 14px;\n  color: #F56C6C;\n}\n</style> "]}]}