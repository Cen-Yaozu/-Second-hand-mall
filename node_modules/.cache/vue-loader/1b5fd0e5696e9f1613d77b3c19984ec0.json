{"remainingRequest":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/-Second-hand-mall/src/components/page/donation-requests.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/macos/Desktop/-Second-hand-mall/src/components/page/donation-requests.vue","mtime":1742002739250},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/babel-loader/lib/index.js","mtime":1741743640250},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js","mtime":1741743643788}],"contextDependencies":[],"result":["\nimport AppHead from '../common/AppHeader.vue';\nimport AppBody from '../common/AppPageBody.vue';\nimport AppFoot from '../common/AppFoot.vue';\n\nexport default {\n  name: 'donation-requests',\n  components: {\n    AppHead,\n    AppBody,\n    AppFoot\n  },\n  data() {\n    return {\n      loading: false,\n      donationRequests: []\n    };\n  },\n  created() {\n    this.loadDonationRequests();\n  },\n  methods: {\n    loadDonationRequests() {\n      this.loading = true;\n      this.$api.getMyDonationRequests().then(res => {\n        if (res.data) {\n          this.donationRequests = res.data;\n        } else {\n          this.donationRequests = [];\n        }\n      }).catch(err => {\n        console.error('获取捐赠请求失败', err);\n        this.$message.error('获取捐赠请求失败');\n      }).finally(() => {\n        this.loading = false;\n      });\n    },\n    getStatusTag(status) {\n      const statusMap = {\n        0: { type: 'info', text: '待审核' },\n        1: { type: 'success', text: '已接受' },\n        2: { type: 'danger', text: '已拒绝' },\n        3: { type: 'primary', text: '已完成' }\n      };\n      return statusMap[status] || { type: 'info', text: '未知状态' };\n    },\n    cancelRequest(requestId) {\n      this.$confirm('确定要取消此捐赠请求吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.$api.cancelDonationRequest(requestId).then(res => {\n          if (res.status_code === 1) {\n            this.$message.success('捐赠请求已取消');\n            this.loadDonationRequests();\n          } else {\n            this.$message.error(res.msg || '操作失败');\n          }\n        }).catch(err => {\n          console.error('取消捐赠请求失败', err);\n          this.$message.error('取消捐赠请求失败');\n        });\n      }).catch(() => {\n        // 取消操作\n      });\n    },\n    viewDonationDetail(requestId) {\n      this.$router.push({\n        path: '/donation/detail',\n        query: { id: requestId }\n      });\n    },\n    goToDonation() {\n      this.$router.push('/donation');\n    },\n    getImageUrl(url) {\n      // 检查url是否已经是HTTP URL\n      if (url && (url.startsWith('http://') || url.startsWith('https://'))) {\n        return url;\n      }\n      \n      // 检查url是否是一个本地文件路径\n      if (url && (url.startsWith('/') || url.startsWith('D:') || url.includes('\\\\') || url.includes('/'))) {\n        // 如果是本地路径，则转换为服务器URL\n        // 这里假设文件名是路径最后的部分\n        const fileName = url.split(/[/\\\\]/).pop();\n        // 构建访问URL\n        return `http://localhost:8082/image?imageName=${fileName}`;\n      }\n      \n      // 如果是简单的文件名，直接构建访问URL\n      if (url && url.trim() !== '') {\n        return `http://localhost:8082/image?imageName=${url}`;\n      }\n      \n      // 其他情况直接返回\n      return url;\n    }\n  }\n};\n",{"version":3,"sources":["donation-requests.vue"],"names":[],"mappings":";AAgEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"donation-requests.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\n  <div>\n    <app-head></app-head>\n    <app-body>\n      <div class=\"donation-container\">\n        <h2 class=\"page-title\">我的捐赠请求</h2>\n        \n        <div v-loading=\"loading\">\n          <div v-if=\"donationRequests.length === 0\" class=\"empty-requests\">\n            <i class=\"el-icon-info\"></i>\n            <p>暂无捐赠请求记录</p>\n            <el-button type=\"primary\" @click=\"goToDonation\">前往捐赠</el-button>\n          </div>\n          \n          <el-card v-for=\"request in donationRequests\" :key=\"request.id\" class=\"request-card\">\n            <div class=\"request-header\">\n              <div class=\"request-info\">\n                <span class=\"request-id\">申请编号: {{ request.id }}</span>\n                <el-tag :type=\"getStatusTag(request.status).type\">{{ getStatusTag(request.status).text }}</el-tag>\n              </div>\n              <div class=\"request-time\">{{ request.createTime }}</div>\n            </div>\n            \n            <div class=\"request-content\">\n              <div class=\"item-card\">\n                <img :src=\"getImageUrl(request.item.pictureList[0])\" class=\"item-img\">\n                <div class=\"item-info\">\n                  <div class=\"item-name\">{{ request.item.idleName }}</div>\n                  <div class=\"item-price\">¥{{ request.item.idlePrice }}</div>\n                </div>\n              </div>\n              \n              <div class=\"donation-details\">\n                <div class=\"donation-type\">\n                  <span class=\"label\">捐赠类型:</span>\n                  <el-tag size=\"small\" type=\"success\" v-if=\"request.donationType === 0\">公益捐赠</el-tag>\n                  <el-tag size=\"small\" type=\"warning\" v-else>环保回收</el-tag>\n                </div>\n                \n                <div class=\"donation-reason\">\n                  <span class=\"label\">捐赠理由:</span>\n                  <div class=\"reason-content\">{{ request.donationReason }}</div>\n                </div>\n                \n                <div class=\"admin-feedback\" v-if=\"request.adminFeedback\">\n                  <span class=\"label\">管理员反馈:</span>\n                  <div class=\"feedback-content\">{{ request.adminFeedback }}</div>\n                </div>\n              </div>\n            </div>\n            \n            <div class=\"request-actions\">\n              <el-button size=\"small\" type=\"danger\" v-if=\"request.status === 0\" @click=\"cancelRequest(request.id)\">取消捐赠</el-button>\n              <el-button size=\"small\" type=\"primary\" v-if=\"request.status === 1\" @click=\"viewDonationDetail(request.id)\">查看详情</el-button>\n            </div>\n          </el-card>\n        </div>\n      </div>\n    </app-body>\n    <app-foot></app-foot>\n  </div>\n</template>\n\n<script>\nimport AppHead from '../common/AppHeader.vue';\nimport AppBody from '../common/AppPageBody.vue';\nimport AppFoot from '../common/AppFoot.vue';\n\nexport default {\n  name: 'donation-requests',\n  components: {\n    AppHead,\n    AppBody,\n    AppFoot\n  },\n  data() {\n    return {\n      loading: false,\n      donationRequests: []\n    };\n  },\n  created() {\n    this.loadDonationRequests();\n  },\n  methods: {\n    loadDonationRequests() {\n      this.loading = true;\n      this.$api.getMyDonationRequests().then(res => {\n        if (res.data) {\n          this.donationRequests = res.data;\n        } else {\n          this.donationRequests = [];\n        }\n      }).catch(err => {\n        console.error('获取捐赠请求失败', err);\n        this.$message.error('获取捐赠请求失败');\n      }).finally(() => {\n        this.loading = false;\n      });\n    },\n    getStatusTag(status) {\n      const statusMap = {\n        0: { type: 'info', text: '待审核' },\n        1: { type: 'success', text: '已接受' },\n        2: { type: 'danger', text: '已拒绝' },\n        3: { type: 'primary', text: '已完成' }\n      };\n      return statusMap[status] || { type: 'info', text: '未知状态' };\n    },\n    cancelRequest(requestId) {\n      this.$confirm('确定要取消此捐赠请求吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.$api.cancelDonationRequest(requestId).then(res => {\n          if (res.status_code === 1) {\n            this.$message.success('捐赠请求已取消');\n            this.loadDonationRequests();\n          } else {\n            this.$message.error(res.msg || '操作失败');\n          }\n        }).catch(err => {\n          console.error('取消捐赠请求失败', err);\n          this.$message.error('取消捐赠请求失败');\n        });\n      }).catch(() => {\n        // 取消操作\n      });\n    },\n    viewDonationDetail(requestId) {\n      this.$router.push({\n        path: '/donation/detail',\n        query: { id: requestId }\n      });\n    },\n    goToDonation() {\n      this.$router.push('/donation');\n    },\n    getImageUrl(url) {\n      // 检查url是否已经是HTTP URL\n      if (url && (url.startsWith('http://') || url.startsWith('https://'))) {\n        return url;\n      }\n      \n      // 检查url是否是一个本地文件路径\n      if (url && (url.startsWith('/') || url.startsWith('D:') || url.includes('\\\\') || url.includes('/'))) {\n        // 如果是本地路径，则转换为服务器URL\n        // 这里假设文件名是路径最后的部分\n        const fileName = url.split(/[/\\\\]/).pop();\n        // 构建访问URL\n        return `http://localhost:8082/image?imageName=${fileName}`;\n      }\n      \n      // 如果是简单的文件名，直接构建访问URL\n      if (url && url.trim() !== '') {\n        return `http://localhost:8082/image?imageName=${url}`;\n      }\n      \n      // 其他情况直接返回\n      return url;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.donation-container {\n  padding: 20px;\n  min-height: 80vh;\n}\n\n.page-title {\n  margin-bottom: 20px;\n  font-size: 24px;\n  color: #303133;\n}\n\n.request-card {\n  margin-bottom: 20px;\n}\n\n.request-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 15px;\n}\n\n.request-info {\n  display: flex;\n  align-items: center;\n}\n\n.request-id {\n  font-size: 14px;\n  color: #606266;\n  margin-right: 10px;\n}\n\n.request-time {\n  color: #909399;\n  font-size: 14px;\n}\n\n.request-content {\n  display: flex;\n  margin-bottom: 15px;\n}\n\n.item-card {\n  width: 120px;\n  text-align: center;\n  margin-right: 20px;\n}\n\n.item-img {\n  width: 100px;\n  height: 100px;\n  object-fit: cover;\n  border-radius: 4px;\n  margin-bottom: 10px;\n}\n\n.item-info {\n  text-align: center;\n}\n\n.item-name {\n  font-size: 14px;\n  color: #303133;\n  margin-bottom: 5px;\n}\n\n.item-price {\n  font-size: 14px;\n  color: #F56C6C;\n}\n\n.donation-details {\n  flex: 1;\n}\n\n.donation-type,\n.donation-reason,\n.admin-feedback {\n  margin-bottom: 10px;\n}\n\n.label {\n  font-weight: bold;\n  color: #606266;\n  margin-right: 10px;\n}\n\n.reason-content,\n.feedback-content {\n  background-color: #F5F7FA;\n  padding: 10px;\n  border-radius: 4px;\n  margin-top: 5px;\n  color: #606266;\n}\n\n.request-actions {\n  display: flex;\n  justify-content: flex-end;\n}\n\n.empty-requests {\n  text-align: center;\n  padding: 30px;\n  color: #909399;\n}\n\n.empty-requests i {\n  font-size: 48px;\n  margin-bottom: 10px;\n}\n\n.empty-requests p {\n  margin-bottom: 20px;\n}\n</style> "]}]}