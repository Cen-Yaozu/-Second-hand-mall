{"remainingRequest":"D:\\Desktop\\-Second-hand-mall\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Desktop\\-Second-hand-mall\\src\\components\\page\\shopCart.vue?vue&type=style&index=0&id=45af47d6&lang=css","dependencies":[{"path":"D:\\Desktop\\-Second-hand-mall\\src\\components\\page\\shopCart.vue","mtime":1741159852061},{"path":"D:\\Desktop\\-Second-hand-mall\\node_modules\\css-loader\\index.js","mtime":1741229036453},{"path":"D:\\Desktop\\-Second-hand-mall\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1741229036550},{"path":"D:\\Desktop\\-Second-hand-mall\\node_modules\\postcss-loader\\src\\index.js","mtime":1741229036447},{"path":"D:\\Desktop\\-Second-hand-mall\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741229036518},{"path":"D:\\Desktop\\-Second-hand-mall\\node_modules\\vue-loader\\lib\\index.js","mtime":1741229036465}],"contextDependencies":[],"result":["\n.shopCart-header{\n    margin-top: 30px;\n    width: auto;\n    padding-left: 7%;\n    height: 7%;\n}\n.el-table-cart{\n    width: 100%;\n    padding-left: 10%;\n}\n",{"version":3,"sources":["shopCart.vue"],"names":[],"mappings":";AAuOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"shopCart.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\r\n    <app-body>\r\n        <app-head></app-head>\r\n        <div class='shopCart-header'>\r\n            <el-button @click=\"toggleSelection(dataList)\">全选</el-button>\r\n            <el-button @click=\"toggleSelection()\">取消选择</el-button>\r\n        </div>\r\n        <el-table\r\n            ref=\"multipleTable\"\r\n            :data=\"dataList\"\r\n            tooltip-effect=\"dark\"\r\n            class='el-table-cart'\r\n            @selection-change=\"handleSelectionChange\">\r\n            <el-table-column\r\n                type=\"selection\"\r\n                width=\"55\">\r\n            </el-table-column>\r\n            <el-table-column\r\n                label=\"商品图片\"\r\n                width=\"400%\">\r\n                <template slot-scope=\"scope\">\r\n                    <div class=\"info\">\r\n                        <div class=\"pic\">\r\n                            <img :src=\"scope.row.imgUrl\" alt=\"商品图片\" width=\"150px\">\r\n                        </div>\r\n                    </div>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column\r\n                prop=\"idleName\"\r\n                label=\"商品名称\"\r\n                width=\"200px\">\r\n            </el-table-column>\r\n            <el-table-column\r\n                prop=\"idlePrice\"\r\n                label=\"商品价格\"\r\n                width=\"200px\">\r\n            </el-table-column>\r\n            <el-table-column\r\n                prop=\"idleDetails\"\r\n                label=\"商品描述\"\r\n                width=\"200px\">\r\n            </el-table-column>\r\n            <el-table-column\r\n                prop=\"idlePlace\"\r\n                label=\"商品所在地\"\r\n                width=\"200px\">\r\n            </el-table-column>\r\n            <el-table-column\r\n                label=\"操作\"\r\n                width=\"200px\">\r\n                <template slot-scope=\"scope\">\r\n                    <el-button icon=\"el-icon-delete\"\r\n                               @click=\"removeShopCart(scope.row,scope.index)\">删除</el-button>\r\n                </template>\r\n            </el-table-column>\r\n        </el-table>\r\n\r\n        <div class='pay'>\r\n            <div>所 选 总 价 ： {{total}}</div>\r\n            <el-button icon='el-icon' @click=\"payAll()\">支 付</el-button>\r\n        </div>\r\n        <app-foot></app-foot>\r\n    </app-body>\r\n\r\n</template>\r\n\r\n<script>\r\nimport AppHead from '@/components/common/AppHeader.vue';\r\nimport AppBody from '@/components/common/AppPageBody.vue';\r\nimport AppFoot from '@/components/common/AppFoot.vue';\r\n\r\nexport default {\r\n\r\n    name: \"shopCart\",\r\n    components: {\r\n        AppHead,\r\n        AppBody,\r\n        AppFoot\r\n    },\r\n    data() {\r\n        return {\r\n            isShowTip: false,\r\n            tipContent: \"\",\r\n            dataList: [],\r\n            idlePlace: '',\r\n            total: 0,\r\n            idleItemids:[],\r\n            favoriteIds:[]\r\n        }\r\n    },\r\n\r\n    mounted() {\r\n    },\r\n    created() {\r\n\r\n        if (!this.$globalData.userInfo.nickname) {\r\n            this.$api.getUserInfo().then(res => {\r\n                if (res.status_code === 1) {\r\n                    res.data.signInTime = res.data.signInTime.substring(0, 10);\r\n                    console.log(res.data);\r\n                    this.$globalData.userInfo = res.data;\r\n                    this.userInfo = this.$globalData.userInfo;\r\n                }\r\n            })\r\n        } else {\r\n            this.userInfo = this.$globalData.userInfo;\r\n            console.log(this.userInfo);\r\n        }\r\n        this.getMyFavorite()\r\n        this.getIdleItemData()\r\n    },\r\n    computed: {\r\n    },\r\n\r\n    methods: {\r\n\r\n        /*支付功能*/\r\n        payAll(){\r\n            this.$api.addOrderByIds({\r\n                idleItemIds:this.idleItemids,\r\n                total_price:this.total,\r\n            }).then(res=>{\r\n                console.log(res);\r\n                if(res.status_code===1){\r\n                    this.$api.removeShopCartByIds({\r\n                        favoriteIds: this.favoriteIds\r\n                    }).then(res=>{\r\n                        // alert(\"支付成功，商品已经从购物车中移出\")\r\n                    })\r\n                    this.$router.push({path: '/order', query: {id: res.data.id}});\r\n                }else {\r\n                    this.$message.error(res.msg)\r\n                }\r\n            }).catch(e=>{\r\n\r\n            })\r\n        },\r\n        /*多选框*/\r\n        toggleSelection(rows) {\r\n            if (rows) {\r\n                rows.forEach(row => {\r\n                    this.$refs.multipleTable.toggleRowSelection(row);\r\n                });\r\n            } else {\r\n                this.$refs.multipleTable.clearSelection();\r\n            }\r\n        },\r\n        handleSelectionChange(val) {\r\n            this.multipleSelection = val;\r\n            console.log(val)\r\n\r\n            /*计算勾选总价*/\r\n            if (val.length !== 0) {\r\n                for (var i = 0; i < val.length; i++){\r\n                    this.idleItemids[i] = val[i].id;\r\n                    this.favoriteIds[i] = val[i].favoriteId;\r\n                }\r\n\r\n                console.log(this.idleItemids,this.favoriteIds)\r\n                this.total = this.countTotal(val, 'idlePrice')\r\n            }else{\r\n                this.total = 0\r\n            }\r\n        },\r\n        countTotal(arr, keyName) {\r\n            let $total = 0\r\n            $total = arr.reduce(function(total, currentValue, currentIndex, arr) {\r\n                return currentValue[keyName] ? (total + currentValue[keyName]) : total\r\n            }, 0)\r\n            return $total\r\n        },\r\n        removeShopCart(row, index) {\r\n            this.$api.deleteFavorite({\r\n                id: row.favoriteId\r\n            }).then(res => {\r\n                console.log(res);\r\n                console.log(row)\r\n                // console.log(\"列表的数据\"+ row.id);\r\n                if (res.status_code === 1) {\r\n                    this.$message({\r\n                        message: '已取消购物车！',\r\n                        type: 'success'\r\n                    });\r\n                    this.dataList.splice(index, 1);\r\n                    // this.getMyFavorite()\r\n                } else {\r\n                    this.$message.error(res.msg)\r\n                }\r\n                // this.getMyFavorite()\r\n            })\r\n        },\r\n        /*获取购物车内容*/\r\n        getMyFavorite() {\r\n            this.$api.getMyFavorite().then(res => {\r\n                console.log('getMyFavorite', res);\r\n                if (res.status_code === 1) {\r\n                    for (let i = 0; i < res.data.length; i++) {\r\n                        let pictureList = JSON.parse(res.data[i].idleItem.pictureList);\r\n                        this.dataList.push({\r\n                            favoriteId: res.data[i].id,\r\n                            id: res.data[i].idleItem.id,\r\n                            imgUrl: pictureList.length > 0 ? pictureList[0] : '',\r\n                            idleName: res.data[i].idleItem.idleName,\r\n                            idleDetails: res.data[i].idleItem.idleDetails,\r\n                            timeStr: res.data[i].createTime.substring(0, 10) + \" \" + res.data[i].createTime.substring(11, 19),\r\n                            idlePrice: res.data[i].idleItem.idlePrice,\r\n                            idleStatus: res.data[i].idleItem.idleStatus\r\n                        });\r\n                        this.idlePlace = res.data[i].idleItem.idlePlace\r\n                    }\r\n                }\r\n            })\r\n        }\r\n}\r\n\r\n}\r\n\r\n</script>\r\n<style>\r\n    .shopCart-header{\r\n        margin-top: 30px;\r\n        width: auto;\r\n        padding-left: 7%;\r\n        height: 7%;\r\n    }\r\n    .el-table-cart{\r\n        width: 100%;\r\n        padding-left: 10%;\r\n    }\r\n</style>"]}]}