{"remainingRequest":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Desktop/-Second-hand-mall/src/components/page/me.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/macos/Desktop/-Second-hand-mall/src/components/page/me.vue","mtime":1741743644073},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/babel-loader/lib/index.js","mtime":1741743640250},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/cache-loader/dist/cjs.js","mtime":1741743640345},{"path":"/Users/macos/Desktop/-Second-hand-mall/node_modules/vue-loader/lib/index.js","mtime":1741743643788}],"contextDependencies":[],"result":["\n    import AppHead from '../common/AppHeader.vue';\n    import AppBody from '../common/AppPageBody.vue'\n    import AppFoot from '../common/AppFoot.vue'\n    import options from '../common/country-data.js'\n\n    export default {\n        name: \"me\",\n        components: {\n            AppHead,\n            AppBody,\n            AppFoot\n        },\n        data() {\n            return {\n                imgFileList: [],\n                addressInfo: {\n                    consigneeName: '',\n                    consigneePhone: '',\n                    provinceName: '',\n                    cityName: '',\n                    regionName: '',\n                    detailAddress: '',\n                    defaultFlag: false\n                },\n                activeName: '1',\n                handleName: ['下架', '删除', '取消收藏', '', ''],\n                dataList: [\n                    [],\n                    [],\n                    [],\n                    [],\n                    [],\n                    [],\n                    [],\n                    [],\n                ],\n                orderStatus: ['待付款', '待发货', '待收货', '已完成', '已取消'],\n                userInfoDialogVisible: false,\n                notUserNicknameEdit: true,\n                userPasswordEdit: false,\n                userPassword1: '',\n                userPassword2: '',\n                userPassword3: '',\n                eidtAddress: false,\n                selectedOptions: [],//存放默认值\n                options: options,   //存放城市数据,\n                userInfo: {\n                    accountNumber: \"\",\n                    avatar: \"\",\n                    nickname: \"\",\n                    signInTime: \"\",\n                },\n                addressData: []\n            };\n        },\n        created() {\n            if (!this.$globalData.userInfo.nickname) {\n                this.$api.getUserInfo().then(res => {\n                    if (res.status_code === 1) {\n                        res.data.signInTime = res.data.signInTime.substring(0, 10);\n                        console.log(res.data);\n                        this.$globalData.userInfo = res.data;\n                        this.userInfo = this.$globalData.userInfo;\n                    }\n                })\n            } else {\n                this.userInfo = this.$globalData.userInfo;\n                console.log(this.userInfo);\n            }\n            this.getAddressData();\n            this.getIdleItemData();\n            this.getMyOrder();\n            this.getMySoldIdle();\n            this.getMyFavorite();\n        },\n        methods: {\n            getMyFavorite(){\n                this.$api.getMyFavorite().then(res=>{\n                    console.log('getMyFavorite',res);\n                    if (res.status_code === 1){\n                        for (let i = 0; i < res.data.length; i++) {\n                            let pictureList = JSON.parse(res.data[i].idleItem.pictureList);\n                            this.dataList[2].push({\n                                favoriteId:res.data[i].id,\n                                id:res.data[i].idleItem.id,\n                                imgUrl:pictureList.length > 0 ? pictureList[0] : '',\n                                idleName:res.data[i].idleItem.idleName,\n                                idleDetails:res.data[i].idleItem.idleDetails,\n                                timeStr:res.data[i].createTime.substring(0, 10) + \" \" + res.data[i].createTime.substring(11, 19),\n                                idlePrice:res.data[i].idleItem.idlePrice\n                            });\n                        }\n                    }\n                })\n            },\n            getMySoldIdle(){\n                this.$api.getMySoldIdle().then(res=>{\n                    if (res.status_code === 1){\n                        console.log('getMySoldIdle',res.data);\n                        for (let i = 0; i < res.data.length; i++) {\n                            let pictureList = JSON.parse(res.data[i].idleItem.pictureList);\n                            this.dataList[3].push({\n                                id:res.data[i].id,\n                                imgUrl:pictureList.length > 0 ? pictureList[0] : '',\n                                idleName:res.data[i].idleItem.idleName,\n                                idleDetails:res.data[i].idleItem.idleDetails,\n                                timeStr:res.data[i].createTime.substring(0, 10) + \" \" + res.data[i].createTime.substring(11, 19),\n                                idlePrice:res.data[i].orderPrice,\n                                orderStatus:res.data[i].orderStatus\n                            });\n                        }\n                    }\n                })\n            },\n            getMyOrder(){\n                this.$api.getMyOrder().then(res=>{\n                    if (res.status_code === 1){\n                        console.log('getMyOrder',res.data);\n                        for (let i = 0; i < res.data.length; i++) {\n                            let pictureList = JSON.parse(res.data[i].idleItem.pictureList);\n                            this.dataList[4].push({\n                                id:res.data[i].id,\n                                imgUrl:pictureList.length > 0 ? pictureList[0] : '',\n                                idleName:res.data[i].idleItem.idleName,\n                                idleDetails:res.data[i].idleItem.idleDetails,\n                                timeStr:res.data[i].createTime.substring(0, 10) + \" \" + res.data[i].createTime.substring(11, 19),\n                                idlePrice:res.data[i].orderPrice,\n                                orderStatus:res.data[i].orderStatus\n                            });\n                        }\n                    }\n                })\n            },\n            getIdleItemData() {\n                this.$api.getAllIdleItem().then(res => {\n                    console.log(res);\n                    if (res.status_code === 1) {\n                        for (let i = 0; i < res.data.length; i++) {\n                            res.data[i].timeStr = res.data[i].releaseTime.substring(0, 10) + \" \" + res.data[i].releaseTime.substring(11, 19);\n                            let pictureList = JSON.parse(res.data[i].pictureList);\n                            res.data[i].imgUrl = pictureList.length > 0 ? pictureList[0] : '';\n                            if (res.data[i].idleStatus === 1) {\n                                this.dataList[0].push(res.data[i]);\n                            } else if (res.data[i].idleStatus === 2) {\n                                this.dataList[1].push(res.data[i]);\n                            }\n                        }\n                    }\n                })\n            },\n            getAddressData() {\n                this.$api.getAddress().then(res => {\n                    if (res.status_code === 1) {\n                        let data = res.data;\n                        for (let i = 0; i < data.length; i++) {\n                            data[i].detailAddressText = data[i].provinceName + data[i].cityName + data[i].regionName + data[i].detailAddress;\n                            data[i].defaultAddress = data[i].defaultFlag ? '默认地址' : '设为默认';\n                        }\n                        console.log(data);\n                        this.addressData = data;\n                    }\n                })\n            },\n            handleClick(tab, event) {\n                // console.log(tab, event);\n                console.log(this.activeName);\n            },\n            saveUserNickname() {\n                this.notUserNicknameEdit = true;\n                this.$api.updateUserPublicInfo({\n                    nickname: this.userInfo.nickname\n                }).then(res => {\n                    console.log(res);\n                    this.$globalData.userInfo.nickname = this.userInfo.nickname;\n                })\n\n            },\n            savePassword() {\n                if (!this.userPassword1 || !this.userPassword2) {\n                    this.$message.error('密码为空！');\n                } else if (this.userPassword2 === this.userPassword3) {\n                    this.$api.updatePassword({\n                        oldPassword: this.userPassword1,\n                        newPassword: this.userPassword2\n                    }).then(res => {\n                        if (res.status_code === 1) {\n                            this.userPasswordEdit = false;\n                            this.$message({\n                                message: '修改成功！',\n                                type: 'success'\n                            });\n                            this.userPassword1 = '';\n                            this.userPassword2 = '';\n                            this.userPassword3 = '';\n                        } else {\n                            this.$message.error('旧密码错误，修改失败！');\n                        }\n                    })\n                } else {\n                    this.$message.error('两次输入的密码不一致！');\n                }\n\n            },\n            finishEdit() {\n                this.notUserNicknameEdit = true;\n                this.userInfoDialogVisible = false;\n                this.userPasswordEdit = false;\n            },\n            handleAddressChange(value) {\n                console.log(value);\n                this.addressInfo.provinceName = value[0];\n                this.addressInfo.cityName = value[1];\n                this.addressInfo.regionName = value[2];\n            },\n            handleEdit(index, row) {\n                console.log(index, row);\n                this.addressInfo = JSON.parse(JSON.stringify(row));\n                this.selectedOptions = ['', '', ''];\n                this.selectedOptions[0] = row.provinceName;\n                this.selectedOptions[1] = row.cityName;\n                this.selectedOptions[2] = row.regionName;\n            },\n            handleDelete(index, row) {\n                console.log(index, row);\n                this.$confirm('是否确定删除该地址?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    this.$api.deleteAddress(row).then(res => {\n                        if (res.status_code === 1) {\n                            this.$message({\n                                message: '删除成功！',\n                                type: 'success'\n                            });\n                            this.addressData.splice(index, 1);\n                            if (row.defaultFlag && this.addressData.length > 0) {\n                                this.addressData[0].defaultFlag = true;\n                                this.addressData[0].defaultAddress = '默认地址';\n                                this.update({\n                                    id: this.addressData[0].id,\n                                    defaultFlag: true\n                                });\n                            }\n                        } else {\n                            this.$message.error('系统异常，删除失败！')\n                        }\n                    }).catch(() => {\n                        this.$message.error('网络异常！')\n                    });\n                }).catch(() => {\n                });\n\n            },\n            handleSetDefault(index, row) {\n                console.log(index, row);\n                row.defaultFlag = true;\n                this.update(row);\n            },\n            toDetails(activeName, item) {\n                if (activeName === '4'||activeName === '5') {\n                    this.$router.push({path: '/order', query: {id: item.id}});\n                } else {\n                    this.$router.push({path: '/details', query: {id: item.id}});\n                }\n            },\n\n            /*\n                个人简介页面中商品的各种按钮功能实现\n            */\n\n            handle(activeName,item,index) {\n                console.log(activeName,item,index);\n                this.$confirm('是否确认？', '提示', {\n                    confirmButtonText: '确认',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    if (activeName === '1') {\n                        this.$api.updateIdleItem({\n                            id: item.id,\n                            idleStatus: 2\n                        }).then(res => {\n                            console.log(res);\n                            if (res.status_code === 1) {\n                                this.dataList[0].splice(index, 1);\n                                item.idleStatus = 2;\n                                this.dataList[1].unshift(item);\n                            } else {\n                                this.$message.error(res.msg)\n                            }\n                        });\n                    } else if (activeName === '2') {\n                        this.$api.updateIdleItem({\n                            id: item.id,\n                            idleStatus: 0\n                        }).then(res => {\n                            console.log(res);\n                            if (res.status_code === 1) {\n                                this.dataList[1].splice(index, 1);\n                            } else {\n                                this.$message.error(res.msg)\n                            }\n                        });\n                    } else if (activeName === '3') {\n                        this.$api.deleteFavorite({\n                            id: item.favoriteId\n                        }).then(res => {\n                            console.log(res);\n                            if (res.status_code === 1) {\n                                this.$message({\n                                    message: '已取消收藏！',\n                                    type: 'success'\n                                });\n                                this.dataList[2].splice(index, 1);\n                            } else {\n                                this.$message.error(res.msg)\n                            }\n                        }).catch(e => {\n                        });\n                    }\n                })\n            },\n            fileHandleSuccess(response, file, fileList) {\n                console.log(\"file:\", response, file, fileList);\n                let imgUrl = response.data;\n                this.imgFileList = [];\n                this.$api.updateUserPublicInfo({\n                    avatar: imgUrl\n                }).then(res => {\n                    console.log(res);\n                    this.userInfo.avatar = imgUrl;\n                    this.$globalData.userInfo.avatar = imgUrl;\n                })\n            },\n            update(data) {\n                this.$api.updateAddress(data).then(res => {\n                    if (res.status_code === 1) {\n                        this.getAddressData();\n                        this.$message({\n                            message: '修改成功！',\n                            type: 'success'\n                        });\n                    } else {\n                        this.$message.error('系统异常，修改失败！')\n                    }\n                }).catch(() => {\n                    this.$message.error('网络异常！')\n                })\n            },\n            saveAddress() {\n                if (this.addressInfo.id) {\n                    console.log('update:', this.addressInfo);\n                    this.update(this.addressInfo);\n                    this.addressInfo = {\n                        consigneeName: '',\n                        consigneePhone: '',\n                        provinceName: '',\n                        cityName: '',\n                        regionName: '',\n                        detailAddress: '',\n                        defaultFlag: false\n                    };\n                    this.selectedOptions = [];\n                } else {\n                    if (this.addressData.length >= 5) {\n                        this.$message.error('已达到最大地址数量！')\n                    } else {\n                        console.log(this.addressInfo);\n                        this.$api.addAddress(this.addressInfo).then(res => {\n                            if (res.status_code === 1) {\n                                this.getAddressData();\n                                this.$message({\n                                    message: '新增成功！',\n                                    type: 'success'\n                                });\n                                this.selectedOptions = [];\n                                this.addressInfo = {\n                                    consigneeName: '',\n                                    consigneePhone: '',\n                                    provinceName: '',\n                                    cityName: '',\n                                    regionName: '',\n                                    detailAddress: '',\n                                    defaultFlag: false\n                                };\n                            } else {\n                                this.$message.error('系统异常，新增失败！')\n                            }\n                        }).catch(e => {\n                            this.$message.error('网络异常！')\n                        })\n                    }\n                }\n            }\n        }\n    }\n",null]}